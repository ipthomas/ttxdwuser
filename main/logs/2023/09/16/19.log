2023/09/16 19:26:11.766926 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 19:26:11.767425 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 19:26:11.767573 ttdb.go:54: Opened Database
2023/09/16 19:26:11.992695 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 19:26:12.057340 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 19:26:12.057597 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 19:26:12.123004 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 19:26:12.230379 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 19:26:12.230525 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 19:26:12.295603 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 19:26:12.362360 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 19:26:12.362513 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 19:26:12.488056 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 19:26:12.615656 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 19:26:12.615751 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 19:26:12.785736 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 19:26:12.896772 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 19:26:12.896924 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 19:26:13.029900 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 19:26:13.283609 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 19:26:13.283755 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 19:26:13.375271 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 19:26:13.467857 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 19:26:13.468062 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 19:26:13.617396 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 19:26:13.784885 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 19:26:13.784920 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 19:26:13.912839 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 19:26:14.046691 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 19:26:14.046861 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 19:26:14.226511 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 19:26:14.345693 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 19:26:14.345840 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 19:26:14.410756 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 19:26:14.531770 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 19:26:14.531900 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 19:26:14.699080 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 19:26:14.892754 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 19:26:14.892845 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 19:26:14.966965 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 19:26:15.078285 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 19:26:15.078370 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 19:26:15.198491 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 19:26:15.354634 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 19:26:15.354837 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 19:26:15.421242 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 19:26:15.534420 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 19:26:15.534592 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 19:26:15.689663 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 19:26:15.804215 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 19:26:15.804354 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 19:26:15.901439 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 19:26:15.974053 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 19:26:15.974182 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 19:26:16.041387 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 19:26:16.113055 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 19:26:16.113176 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 19:26:16.179241 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 19:26:16.250971 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 19:26:16.251105 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 19:26:16.317690 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 19:26:16.388965 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 19:26:16.389149 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 19:26:16.455668 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 19:26:16.527647 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 19:26:16.527745 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 19:26:16.595209 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 19:26:16.662559 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 19:26:16.662746 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 19:26:16.663148 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 19:26:29.171893 ttgethandler.go:10: Processing new GET Request
2023/09/16 19:26:29.171976 ttgethandler.go:10: Processing new GET Request
2023/09/16 19:26:29.172052 ttproxy.go:138: 	Request Query Params
2023/09/16 19:26:29.172595 ttproxy.go:138: 	Request Query Params
2023/09/16 19:26:29.172927 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "2tsolutions",
  "Role": "clinical"
}
2023/09/16 19:26:29.172964 ttgethandler.go:15: Path = /beta/spa/consumer/expressions
2023/09/16 19:26:29.173807 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "2tsolutions",
  "Role": "clinical",
  "Nhs": "9000000009",
  "Vers": "-1"
}
2023/09/16 19:26:29.173848 ttgethandler.go:15: Path = /beta/spa/consumer/xdws
2023/09/16 19:26:29.173908 ttproxy.go:149: Response Status Code 200
2023/09/16 19:26:29.241524 ttxdwconsumer.go:407: selected 0 Workflows for Pathway  NHS 9000000009 Version -1
2023/09/16 19:26:29.304342 ttxdwconsumer.go:213: Setting Workflow States
2023/09/16 19:26:29.496981 tttmplts.go:100: Caching 24 Templates
2023/09/16 19:26:29.501537 tttmplts.go:104: Template pdssearch_tmplt caused Error template: pdssearch_tmplt:110: undefined variable "$pat"
2023/09/16 19:26:29.502191 server.go:3217: http: panic serving [::1]:56145: runtime error: invalid memory address or nil pointer dereference
goroutine 20 [running]:
net/http.(*conn).serve.func1()
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1854 +0xbf
panic({0x1434d00, 0x17e4e70})
	/Users/IanThomas/sdk/go1.20.5/src/runtime/panic.go:890 +0x263
html/template.(*Template).New(0x14c1c62?, {0xc000028300?, 0xc00046dfa8?})
	/Users/IanThomas/sdk/go1.20.5/src/html/template/template.go:305 +0x37
main.(*Trans).cacheTemplates(0xc0003d6000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:103 +0x1d2
main.(*Trans).setResponseFromTemplate(0xc0003d6000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:85 +0x45
main.(*Trans).setXDWs(0xc0003d6000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttxdwconsumer.go:187 +0x13e
main.(*Trans).newGetHandler(0xc0003d6000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttgethandler.go:40 +0xd76
main.(*Trans).newProxyTrans(0xc0003d6000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:73 +0x4d1
main.Handle_HTTP_Request({0x1565db0, 0xc00037cb60}, 0xc0003c4000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:15 +0xeb
net/http.HandlerFunc.ServeHTTP(0xc0003c601c?, {0x1565db0?, 0xc00037cb60?}, 0x1064cee?)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2122 +0x2f
net/http.serverHandler.ServeHTTP({0xc00020f6e0?}, {0x1565db0, 0xc00037cb60}, 0xc0003c4000)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2936 +0x316
net/http.(*conn).serve(0xc000196360, {0x1565fa8, 0xc00017e480})
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1995 +0x612
created by net/http.(*Server).Serve
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:3089 +0x5ed
2023/09/16 19:34:57.518960 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 19:35:02.392665 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 19:35:02.393145 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 19:35:02.393277 ttdb.go:54: Opened Database
2023/09/16 19:35:02.582886 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 19:35:02.647843 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 19:35:02.647886 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 19:35:02.712041 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 19:35:02.811402 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 19:35:02.811554 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 19:35:02.877339 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 19:35:02.945071 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 19:35:02.945186 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 19:35:03.011324 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 19:35:03.076536 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 19:35:03.076621 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 19:35:03.139632 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 19:35:03.202756 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 19:35:03.202805 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 19:35:03.266237 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 19:35:03.380862 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 19:35:03.380968 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 19:35:03.444310 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 19:35:03.507211 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 19:35:03.507364 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 19:35:03.575109 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 19:35:03.637443 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 19:35:03.637489 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 19:35:03.703365 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 19:35:03.772591 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 19:35:03.772737 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 19:35:03.835854 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 19:35:03.899812 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 19:35:03.899884 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 19:35:03.962589 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 19:35:04.040639 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 19:35:04.040784 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 19:35:04.106080 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 19:35:04.187631 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 19:35:04.187723 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 19:35:04.254948 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 19:35:04.323775 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 19:35:04.323839 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 19:35:04.386959 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 19:35:04.450612 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 19:35:04.450715 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 19:35:04.514652 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 19:35:04.577701 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 19:35:04.577812 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 19:35:04.639829 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 19:35:04.706935 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 19:35:04.707052 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 19:35:04.769691 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 19:35:04.835749 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 19:35:04.835809 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 19:35:04.898147 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 19:35:04.963267 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 19:35:04.963349 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 19:35:05.025734 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 19:35:05.098283 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 19:35:05.098390 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 19:35:05.161031 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 19:35:05.229731 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 19:35:05.229775 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 19:35:05.292674 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 19:35:05.360003 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 19:35:05.360074 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 19:35:05.423484 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 19:35:05.488812 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 19:35:05.488904 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 19:35:05.489144 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 19:35:52.588724 ttgethandler.go:10: Processing new GET Request
2023/09/16 19:35:52.588886 ttproxy.go:138: 	Request Query Params
2023/09/16 19:35:52.589212 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "2tsolutions",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 19:35:52.589252 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 19:35:52.589295 tttmplts.go:37: CGL Worker starting
2023/09/16 19:35:52.589293 tttmplts.go:30: PIXm Worker starting
2023/09/16 19:35:52.589675 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 19:35:52.591303 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 19:35:52.591323 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 19:35:53.035651 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 19:35:53.042619 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 19:35:53.042782 tttmplts.go:39: CGL Worker done
2023/09/16 19:35:53.042824 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 19:35:57.590989 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 19:35:57.591276 tttmplts.go:32: PIXm Worker done
2023/09/16 19:35:57.591321 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 19:35:57.591739 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 19:35:57.591914 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[ca9e9d1f-bcae-4a8c-a273-4ee43e728281]]
2023/09/16 19:35:57.870245 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 19:35:58.122922 tttmplts.go:100: Caching 24 Templates
2023/09/16 19:35:58.124459 tttmplts.go:104: Template pdssearch_tmplt caused Error template: pdssearch_tmplt:127: unexpected {{end}}
2023/09/16 19:35:58.124987 server.go:3217: http: panic serving [::1]:56296: runtime error: invalid memory address or nil pointer dereference
goroutine 36 [running]:
net/http.(*conn).serve.func1()
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1854 +0xbf
panic({0x1434d00, 0x17e4e70})
	/Users/IanThomas/sdk/go1.20.5/src/runtime/panic.go:890 +0x263
html/template.(*Template).New(0x14c1c62?, {0xc000028228?, 0xc00045bfc0?})
	/Users/IanThomas/sdk/go1.20.5/src/html/template/template.go:305 +0x37
main.(*Trans).cacheTemplates(0xc000266000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:103 +0x1d2
main.(*Trans).setResponseFromTemplate(0xc000266000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:85 +0x45
main.(*Trans).setPatientTemplate(0xc000266000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:53 +0x1b1
main.(*Trans).newGetHandler(0xc000266000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttgethandler.go:28 +0xd94
main.(*Trans).newProxyTrans(0xc000266000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:73 +0x4d1
main.Handle_HTTP_Request({0x1565db0, 0xc00020b180}, 0xc00021a100)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:15 +0xeb
net/http.HandlerFunc.ServeHTTP(0xc00003416f?, {0x1565db0?, 0xc00020b180?}, 0x1064cee?)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2122 +0x2f
net/http.serverHandler.ServeHTTP({0xc00020e9f0?}, {0x1565db0, 0xc00020b180}, 0xc00021a100)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2936 +0x316
net/http.(*conn).serve(0xc0000a8cf0, {0x1565fa8, 0xc00009af00})
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1995 +0x612
created by net/http.(*Server).Serve
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:3089 +0x5ed
2023/09/16 19:38:46.422930 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 19:38:48.270812 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 19:38:48.271279 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 19:38:48.271440 ttdb.go:54: Opened Database
2023/09/16 19:38:48.467484 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 19:38:48.533218 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 19:38:48.533271 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 19:38:48.598983 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 19:38:48.697956 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 19:38:48.698001 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 19:38:48.764336 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 19:38:48.839517 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 19:38:48.839638 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 19:38:48.905331 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 19:38:48.974904 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 19:38:48.974947 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 19:38:49.041759 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 19:38:49.111351 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 19:38:49.111541 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 19:38:49.179315 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 19:38:49.304165 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 19:38:49.304303 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 19:38:49.372268 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 19:38:49.441090 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 19:38:49.441259 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 19:38:49.508245 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 19:38:49.576116 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 19:38:49.576267 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 19:38:49.643641 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 19:38:49.717123 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 19:38:49.717262 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 19:38:49.784598 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 19:38:49.853311 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 19:38:49.853457 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 19:38:49.921287 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 19:38:50.002763 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 19:38:50.002864 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 19:38:50.068524 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 19:38:50.150499 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 19:38:50.150541 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 19:38:50.217656 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 19:38:50.289426 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 19:38:50.289640 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 19:38:50.356135 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 19:38:50.430697 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 19:38:50.430837 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 19:38:50.501600 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 19:38:50.580834 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 19:38:50.580967 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 19:38:50.648287 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 19:38:50.713955 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 19:38:50.714093 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 19:38:50.789967 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 19:38:50.860381 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 19:38:50.860504 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 19:38:50.927764 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 19:38:50.998048 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 19:38:50.998106 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 19:38:51.064695 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 19:38:51.132065 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 19:38:51.132094 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 19:38:51.199846 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 19:38:51.271777 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 19:38:51.271897 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 19:38:51.339101 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 19:38:51.410572 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 19:38:51.410677 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 19:38:51.478075 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 19:38:51.547939 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 19:38:51.548076 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 19:38:51.548608 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 19:38:54.418450 ttgethandler.go:10: Processing new GET Request
2023/09/16 19:38:54.418610 ttproxy.go:138: 	Request Query Params
2023/09/16 19:38:54.418932 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "2tsolutions",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 19:38:54.418966 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 19:38:54.419018 tttmplts.go:37: CGL Worker starting
2023/09/16 19:38:54.419011 tttmplts.go:30: PIXm Worker starting
2023/09/16 19:38:54.419666 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 19:38:54.420912 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 19:38:54.420930 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 19:38:54.602644 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 19:38:54.608710 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 19:38:54.608783 tttmplts.go:39: CGL Worker done
2023/09/16 19:38:54.608807 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 19:38:59.421001 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 19:38:59.421197 tttmplts.go:32: PIXm Worker done
2023/09/16 19:38:59.421233 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 19:38:59.421449 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 19:38:59.421586 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[bd9705ef-bd29-4c83-81f9-bed8b2aead8d]]
2023/09/16 19:38:59.573793 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 19:38:59.770858 tttmplts.go:100: Caching 24 Templates
2023/09/16 19:38:59.772557 tttmplts.go:104: Template pdssearch_tmplt caused Error template: pdssearch_tmplt:74: undefined variable "$td"
2023/09/16 19:38:59.773181 server.go:3217: http: panic serving [::1]:56354: runtime error: invalid memory address or nil pointer dereference
goroutine 51 [running]:
net/http.(*conn).serve.func1()
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1854 +0xbf
panic({0x1434d00, 0x17e4e70})
	/Users/IanThomas/sdk/go1.20.5/src/runtime/panic.go:890 +0x263
html/template.(*Template).New(0x14c1c62?, {0xc0001aa318?, 0xc000635fc0?})
	/Users/IanThomas/sdk/go1.20.5/src/html/template/template.go:305 +0x37
main.(*Trans).cacheTemplates(0xc000258000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:103 +0x1d2
main.(*Trans).setResponseFromTemplate(0xc000258000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:85 +0x45
main.(*Trans).setPatientTemplate(0xc000258000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:53 +0x1b1
main.(*Trans).newGetHandler(0xc000258000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttgethandler.go:28 +0xd94
main.(*Trans).newProxyTrans(0xc000258000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:73 +0x4d1
main.Handle_HTTP_Request({0x1565db0, 0xc0002360e0}, 0xc000240000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:15 +0xeb
net/http.HandlerFunc.ServeHTTP(0xc00024201f?, {0x1565db0?, 0xc0002360e0?}, 0x1064cee?)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2122 +0x2f
net/http.serverHandler.ServeHTTP({0xc00020e1e0?}, {0x1565db0, 0xc0002360e0}, 0xc000240000)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2936 +0x316
net/http.(*conn).serve(0xc0001c70e0, {0x1565fa8, 0xc00019b530})
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1995 +0x612
created by net/http.(*Server).Serve
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:3089 +0x5ed
2023/09/16 19:40:38.176067 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 19:40:41.286243 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 19:40:41.286723 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 19:40:41.286858 ttdb.go:54: Opened Database
2023/09/16 19:40:41.474800 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 19:40:41.540478 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 19:40:41.540545 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 19:40:41.605875 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 19:40:41.707624 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 19:40:41.707754 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 19:40:41.775827 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 19:40:41.853090 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 19:40:41.853225 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 19:40:41.917670 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 19:40:41.985985 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 19:40:41.986071 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 19:40:42.057422 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 19:40:42.122908 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 19:40:42.122987 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 19:40:42.187863 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 19:40:42.309578 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 19:40:42.309659 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 19:40:42.375313 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 19:40:42.442217 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 19:40:42.442317 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 19:40:42.508037 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 19:40:42.573761 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 19:40:42.573880 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 19:40:42.639500 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 19:40:42.713161 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 19:40:42.713292 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 19:40:42.779333 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 19:40:42.846431 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 19:40:42.846579 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 19:40:42.912417 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 19:40:42.992161 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 19:40:42.992297 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 19:40:43.057948 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 19:40:43.140991 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 19:40:43.141131 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 19:40:43.209080 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 19:40:43.280576 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 19:40:43.280739 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 19:40:43.348719 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 19:40:43.418855 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 19:40:43.419014 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 19:40:43.485381 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 19:40:43.553516 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 19:40:43.553673 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 19:40:43.621960 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 19:40:43.690681 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 19:40:43.690828 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 19:40:43.758912 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 19:40:43.828993 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 19:40:43.829042 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 19:40:43.894670 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 19:40:43.961946 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 19:40:43.962096 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 19:40:44.027811 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 19:40:44.098808 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 19:40:44.098948 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 19:40:44.164121 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 19:40:44.238207 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 19:40:44.238266 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 19:40:44.304753 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 19:40:44.374072 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 19:40:44.374160 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 19:40:44.441019 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 19:40:44.509522 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 19:40:44.509624 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 19:40:44.509927 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 19:40:47.816382 ttgethandler.go:10: Processing new GET Request
2023/09/16 19:40:47.816535 ttproxy.go:138: 	Request Query Params
2023/09/16 19:40:47.816974 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "2tsolutions",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 19:40:47.817013 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 19:40:47.817050 tttmplts.go:37: CGL Worker starting
2023/09/16 19:40:47.817056 tttmplts.go:30: PIXm Worker starting
2023/09/16 19:40:47.817246 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 19:40:47.818721 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 19:40:47.818740 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 19:40:48.078513 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 19:40:48.081690 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 19:40:48.081807 tttmplts.go:39: CGL Worker done
2023/09/16 19:40:48.081830 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 19:40:52.818582 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 19:40:52.819091 tttmplts.go:32: PIXm Worker done
2023/09/16 19:40:52.819161 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 19:40:52.819405 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 19:40:52.819691 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[aba23ebd-5962-4bfe-9e57-0ece7e2fcf9a]]
2023/09/16 19:40:52.969353 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 19:40:53.164241 tttmplts.go:100: Caching 24 Templates
2023/09/16 19:40:53.165807 tttmplts.go:104: Template pdssearch_tmplt caused Error template: pdssearch_tmplt:74: undefined variable "$td"
2023/09/16 19:40:53.166530 server.go:3217: http: panic serving [::1]:56393: runtime error: invalid memory address or nil pointer dereference
goroutine 9 [running]:
net/http.(*conn).serve.func1()
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1854 +0xbf
panic({0x1434d00, 0x17e4e70})
	/Users/IanThomas/sdk/go1.20.5/src/runtime/panic.go:890 +0x263
html/template.(*Template).New(0x14c1c62?, {0xc00009e390?, 0xc0001effc0?})
	/Users/IanThomas/sdk/go1.20.5/src/html/template/template.go:305 +0x37
main.(*Trans).cacheTemplates(0xc0000f0000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:103 +0x1d2
main.(*Trans).setResponseFromTemplate(0xc0000f0000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:85 +0x45
main.(*Trans).setPatientTemplate(0xc0000f0000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:53 +0x1b1
main.(*Trans).newGetHandler(0xc0000f0000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttgethandler.go:28 +0xd94
main.(*Trans).newProxyTrans(0xc0000f0000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:73 +0x4d1
main.Handle_HTTP_Request({0x1565db0, 0xc0000b8380}, 0xc0000d8000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:15 +0xeb
net/http.HandlerFunc.ServeHTTP(0xc0000da01f?, {0x1565db0?, 0xc0000b8380?}, 0x1064cee?)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2122 +0x2f
net/http.serverHandler.ServeHTTP({0xc0000a22a0?}, {0x1565db0, 0xc0000b8380}, 0xc0000d8000)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2936 +0x316
net/http.(*conn).serve(0xc00021b200, {0x1565fa8, 0xc000207830})
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1995 +0x612
created by net/http.(*Server).Serve
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:3089 +0x5ed
2023/09/16 19:42:00.009215 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 19:42:01.774800 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 19:42:01.775276 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 19:42:01.775410 ttdb.go:54: Opened Database
2023/09/16 19:42:02.168884 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 19:42:02.270605 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 19:42:02.270853 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 19:42:02.373437 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 19:42:02.482582 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 19:42:02.482746 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 19:42:02.594083 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 19:42:02.682076 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 19:42:02.682105 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 19:42:02.772286 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 19:42:02.834901 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 19:42:02.834923 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 19:42:02.897386 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 19:42:02.963919 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 19:42:02.964067 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 19:42:03.028369 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 19:42:03.147128 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 19:42:03.147155 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 19:42:03.209342 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 19:42:03.274598 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 19:42:03.274625 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 19:42:03.336463 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 19:42:03.398942 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 19:42:03.398998 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 19:42:03.461325 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 19:42:03.530640 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 19:42:03.530764 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 19:42:03.596780 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 19:42:03.658718 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 19:42:03.658738 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 19:42:03.721544 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 19:42:03.797796 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 19:42:03.797876 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 19:42:03.861247 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 19:42:03.938517 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 19:42:03.938538 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 19:42:04.003446 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 19:42:04.073704 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 19:42:04.073842 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 19:42:04.136837 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 19:42:04.200930 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 19:42:04.201048 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 19:42:04.264337 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 19:42:04.327974 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 19:42:04.328121 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 19:42:04.394174 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 19:42:04.459968 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 19:42:04.460106 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 19:42:04.523122 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 19:42:04.587931 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 19:42:04.588003 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 19:42:04.673690 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 19:42:04.786527 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 19:42:04.786611 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 19:42:04.929774 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 19:42:05.024669 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 19:42:05.024807 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 19:42:05.152383 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 19:42:05.311274 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 19:42:05.311383 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 19:42:05.430680 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 19:42:05.514198 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 19:42:05.514327 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 19:42:05.612204 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 19:42:05.684265 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 19:42:05.684393 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 19:42:05.684673 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 19:42:08.576994 ttgethandler.go:10: Processing new GET Request
2023/09/16 19:42:08.577159 ttproxy.go:138: 	Request Query Params
2023/09/16 19:42:08.577552 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "2tsolutions",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 19:42:08.577590 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 19:42:08.577638 tttmplts.go:30: PIXm Worker starting
2023/09/16 19:42:08.577651 tttmplts.go:37: CGL Worker starting
2023/09/16 19:42:08.577987 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 19:42:08.581278 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 19:42:08.581439 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 19:42:08.770604 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 19:42:08.776424 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 19:42:08.776506 tttmplts.go:39: CGL Worker done
2023/09/16 19:42:08.776528 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 19:42:13.579388 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 19:42:13.579800 tttmplts.go:32: PIXm Worker done
2023/09/16 19:42:13.579875 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 19:42:13.580056 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 19:42:13.580201 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[1c41c545-9390-4d6f-aded-99ee96d3129d]]
2023/09/16 19:42:13.737335 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 19:42:13.928690 tttmplts.go:100: Caching 24 Templates
2023/09/16 19:42:13.930591 tttmplts.go:104: Template pdssearch_tmplt caused Error template: pdssearch_tmplt:74: undefined variable "$td"
2023/09/16 19:42:13.931237 server.go:3217: http: panic serving [::1]:56417: runtime error: invalid memory address or nil pointer dereference
goroutine 50 [running]:
net/http.(*conn).serve.func1()
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1854 +0xbf
panic({0x1434d00, 0x17e4e70})
	/Users/IanThomas/sdk/go1.20.5/src/runtime/panic.go:890 +0x263
html/template.(*Template).New(0x14c1c62?, {0xc000222210?, 0xc000605fc0?})
	/Users/IanThomas/sdk/go1.20.5/src/html/template/template.go:305 +0x37
main.(*Trans).cacheTemplates(0xc00014e000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:103 +0x1d2
main.(*Trans).setResponseFromTemplate(0xc00014e000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:85 +0x45
main.(*Trans).setPatientTemplate(0xc00014e000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:53 +0x1b1
main.(*Trans).newGetHandler(0xc00014e000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttgethandler.go:28 +0xd94
main.(*Trans).newProxyTrans(0xc00014e000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:73 +0x4d1
main.Handle_HTTP_Request({0x1565db0, 0xc0001261c0}, 0xc000134000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:15 +0xeb
net/http.HandlerFunc.ServeHTTP(0xc00013601f?, {0x1565db0?, 0xc0001261c0?}, 0x1064cee?)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2122 +0x2f
net/http.serverHandler.ServeHTTP({0xc000112120?}, {0x1565db0, 0xc0001261c0}, 0xc000134000)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2936 +0x316
net/http.(*conn).serve(0xc000234990, {0x1565fa8, 0xc00022cc60})
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1995 +0x612
created by net/http.(*Server).Serve
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:3089 +0x5ed
2023/09/16 19:43:18.779260 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 19:43:21.517515 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 19:43:21.518026 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 19:43:21.518160 ttdb.go:54: Opened Database
2023/09/16 19:43:22.204167 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 19:43:22.282779 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 19:43:22.282973 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 19:43:22.450419 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 19:43:22.673843 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 19:43:22.674034 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 19:43:22.739490 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 19:43:22.809352 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 19:43:22.809526 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 19:43:22.875091 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 19:43:22.940599 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 19:43:22.940707 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 19:43:23.006678 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 19:43:23.071765 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 19:43:23.071936 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 19:43:23.137387 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 19:43:23.261306 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 19:43:23.261342 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 19:43:23.324975 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 19:43:23.388753 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 19:43:23.388795 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 19:43:23.454408 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 19:43:23.520982 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 19:43:23.521127 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 19:43:23.585580 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 19:43:23.656887 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 19:43:23.657038 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 19:43:23.722921 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 19:43:23.788782 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 19:43:23.788896 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 19:43:23.854298 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 19:43:23.930500 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 19:43:23.930635 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 19:43:23.995043 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 19:43:24.077333 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 19:43:24.077461 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 19:43:24.140938 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 19:43:24.212856 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 19:43:24.212983 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 19:43:24.277285 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 19:43:24.344430 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 19:43:24.344550 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 19:43:24.409351 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 19:43:24.476210 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 19:43:24.476430 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 19:43:24.541216 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 19:43:24.606912 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 19:43:24.607027 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 19:43:24.671219 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 19:43:24.738143 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 19:43:24.738256 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 19:43:24.803163 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 19:43:24.874990 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 19:43:24.875057 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 19:43:24.939667 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 19:43:25.008067 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 19:43:25.008234 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 19:43:25.071646 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 19:43:25.142097 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 19:43:25.142183 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 19:43:25.207459 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 19:43:25.276295 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 19:43:25.276457 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 19:43:25.341824 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 19:43:25.407103 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 19:43:25.407225 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 19:43:25.407472 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 19:43:28.107154 ttgethandler.go:10: Processing new GET Request
2023/09/16 19:43:28.107345 ttproxy.go:138: 	Request Query Params
2023/09/16 19:43:28.107871 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "2tsolutions",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 19:43:28.107924 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 19:43:28.107990 tttmplts.go:37: CGL Worker starting
2023/09/16 19:43:28.107999 tttmplts.go:30: PIXm Worker starting
2023/09/16 19:43:28.108329 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 19:43:28.111348 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 19:43:28.111376 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 19:43:28.294115 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 19:43:28.297132 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 19:43:28.297286 tttmplts.go:39: CGL Worker done
2023/09/16 19:43:28.297352 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 19:43:33.109791 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 19:43:33.110032 tttmplts.go:32: PIXm Worker done
2023/09/16 19:43:33.110063 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 19:43:33.110186 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 19:43:33.110273 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[c2d8a619-be7e-4496-94ec-d31fcf0f1a03]]
2023/09/16 19:43:33.252639 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 19:43:33.441503 tttmplts.go:100: Caching 24 Templates
2023/09/16 19:43:33.443222 tttmplts.go:104: Template pdssearch_tmplt caused Error template: pdssearch_tmplt:127: unexpected {{end}}
2023/09/16 19:43:33.443794 server.go:3217: http: panic serving [::1]:56447: runtime error: invalid memory address or nil pointer dereference
goroutine 35 [running]:
net/http.(*conn).serve.func1()
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1854 +0xbf
panic({0x1434d00, 0x17e4e70})
	/Users/IanThomas/sdk/go1.20.5/src/runtime/panic.go:890 +0x263
html/template.(*Template).New(0x14c1c62?, {0xc0000be210?, 0xc000587fc0?})
	/Users/IanThomas/sdk/go1.20.5/src/html/template/template.go:305 +0x37
main.(*Trans).cacheTemplates(0xc0003aa000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:103 +0x1d2
main.(*Trans).setResponseFromTemplate(0xc0003aa000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:85 +0x45
main.(*Trans).setPatientTemplate(0xc0003aa000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:53 +0x1b1
main.(*Trans).newGetHandler(0xc0003aa000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttgethandler.go:28 +0xd94
main.(*Trans).newProxyTrans(0xc0003aa000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:73 +0x4d1
main.Handle_HTTP_Request({0x1565db0, 0xc000353420}, 0xc000158200)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:15 +0xeb
net/http.HandlerFunc.ServeHTTP(0xc0000340ff?, {0x1565db0?, 0xc000353420?}, 0x1064cee?)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2122 +0x2f
net/http.serverHandler.ServeHTTP({0xc00016b950?}, {0x1565db0, 0xc000353420}, 0xc000158200)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2936 +0x316
net/http.(*conn).serve(0xc00021a480, {0x1565fa8, 0xc0002165d0})
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1995 +0x612
created by net/http.(*Server).Serve
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:3089 +0x5ed
2023/09/16 19:47:47.055053 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 19:47:48.932185 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 19:47:48.932672 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 19:47:48.932811 ttdb.go:54: Opened Database
2023/09/16 19:47:49.146630 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 19:47:49.208356 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 19:47:49.208422 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 19:47:49.270114 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 19:47:49.367696 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 19:47:49.367865 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 19:47:49.430775 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 19:47:49.496635 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 19:47:49.496697 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 19:47:49.560360 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 19:47:49.623399 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 19:47:49.623551 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 19:47:49.686382 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 19:47:49.748860 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 19:47:49.748985 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 19:47:49.812457 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 19:47:49.938366 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 19:47:49.938520 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 19:47:50.001380 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 19:47:50.067307 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 19:47:50.067489 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 19:47:50.131923 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 19:47:50.194419 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 19:47:50.194594 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 19:47:50.258054 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 19:47:50.327324 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 19:47:50.327446 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 19:47:50.391686 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 19:47:50.456401 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 19:47:50.456578 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 19:47:50.521036 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 19:47:50.597778 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 19:47:50.597961 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 19:47:50.665521 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 19:47:50.742940 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 19:47:50.742983 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 19:47:50.806107 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 19:47:50.872008 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 19:47:50.872043 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 19:47:50.935437 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 19:47:50.998626 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 19:47:50.998796 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 19:47:51.062115 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 19:47:51.128240 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 19:47:51.128366 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 19:47:51.193018 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 19:47:51.258362 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 19:47:51.258574 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 19:47:51.323916 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 19:47:51.392218 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 19:47:51.392381 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 19:47:51.456914 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 19:47:51.523458 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 19:47:51.523616 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 19:47:51.749625 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 19:47:51.885470 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 19:47:51.885660 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 19:47:51.949377 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 19:47:52.020855 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 19:47:52.021057 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 19:47:52.085986 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 19:47:52.159650 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 19:47:52.159810 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 19:47:52.222278 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 19:47:52.286016 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 19:47:52.286148 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 19:47:52.286400 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 19:47:54.854210 ttgethandler.go:10: Processing new GET Request
2023/09/16 19:47:54.854384 ttproxy.go:138: 	Request Query Params
2023/09/16 19:47:54.854725 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "2tsolutions",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 19:47:54.854768 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 19:47:54.854817 tttmplts.go:37: CGL Worker starting
2023/09/16 19:47:54.854817 tttmplts.go:30: PIXm Worker starting
2023/09/16 19:47:54.855315 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 19:47:54.856566 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 19:47:54.856723 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 19:47:55.029408 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 19:47:55.035399 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 19:47:55.035489 tttmplts.go:39: CGL Worker done
2023/09/16 19:47:55.035524 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 19:47:59.856247 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 19:47:59.856613 tttmplts.go:32: PIXm Worker done
2023/09/16 19:47:59.856672 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 19:47:59.856837 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 19:47:59.856945 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[6a3c3e27-af26-404e-842f-e33c01fe5d50]]
2023/09/16 19:48:00.021874 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 19:48:00.213855 tttmplts.go:100: Caching 24 Templates
2023/09/16 19:48:00.219918 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 19:48:00.290642 ttproxy.go:149: Response Status Code 200
2023/09/16 20:17:50.441987 ttgethandler.go:10: Processing new GET Request
2023/09/16 20:17:50.442154 ttproxy.go:138: 	Request Query Params
2023/09/16 20:17:50.442235 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "2tsolutions",
  "Role": "clinical"
}
2023/09/16 20:17:50.442263 ttgethandler.go:15: Path = /beta/spa/consumer/expressions
2023/09/16 20:17:50.442306 ttproxy.go:149: Response Status Code 200
2023/09/16 20:17:50.442585 ttgethandler.go:10: Processing new GET Request
2023/09/16 20:17:50.442658 ttproxy.go:138: 	Request Query Params
2023/09/16 20:17:50.442704 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "2tsolutions",
  "Role": "clinical",
  "Nhs": "6072406157",
  "Vers": "-1"
}
2023/09/16 20:17:50.442735 ttgethandler.go:15: Path = /beta/spa/consumer/xdws
2023/09/16 20:17:50.604307 ttxdwconsumer.go:407: selected 11 Workflows for Pathway  NHS 6072406157 Version -1
2023/09/16 20:17:50.668735 ttxdwconsumer.go:213: Setting Workflow States
2023/09/16 20:17:50.670209 ttxdwconsumer.go:226: Setting D2A Workflow state for Patient 6072406157
2023/09/16 20:17:50.674012 ttxdwconsumer.go:327: Workflow Started 2023-08-24 19:18:57 +0100 BST Status CLOSED
2023/09/16 20:17:50.674137 ttxdwconsumer.go:330: Time Now 2023-09-16 20:17:50.674132 +0100 BST
2023/09/16 20:17:50.674546 ttxdwconsumer.go:333: Workflow is Complete. Latest Event Time was 2023-08-24 19:42:42 +0000 UTC
2023/09/16 20:17:50.674566 ttxdwconsumer.go:336: Duration - 0 Days 1 Hrs 23 Mins
2023/09/16 20:17:50.674667 ttxdwconsumer.go:351: Checking if Workflow is Overdue
2023/09/16 20:17:50.674740 ttxdwconsumer.go:354: Workflow Complete By Date is 2023-09-13 19:18:57 +0100 BST
2023/09/16 20:17:50.675081 ttxdwconsumer.go:358: Workflow Latest Event Time 2023-08-24 19:42:42 +0000 UTC. Workflow Target Met = true
2023/09/16 20:17:50.675220 ttxdwconsumer.go:296: Workflow d2a6072406157 is CLOSED
2023/09/16 20:17:50.675522 ttxdwconsumer.go:226: Setting EREF Workflow state for Patient 6072406157
2023/09/16 20:17:50.675985 ttxdwconsumer.go:327: Workflow Started 2023-08-24 19:23:11 +0100 BST Status CLOSED
2023/09/16 20:17:50.676041 ttxdwconsumer.go:330: Time Now 2023-09-16 20:17:50.676039 +0100 BST
2023/09/16 20:17:50.676257 ttxdwconsumer.go:333: Workflow is Complete. Latest Event Time was 2023-08-24 19:22:58 +0000 UTC
2023/09/16 20:17:50.676270 ttxdwconsumer.go:336: Duration - 0 Days 0 Hrs 59 Mins
2023/09/16 20:17:50.676322 ttxdwconsumer.go:351: Checking if Workflow is Overdue
2023/09/16 20:17:50.676375 ttxdwconsumer.go:354: Workflow Complete By Date is 2023-08-26 19:23:11 +0100 BST
2023/09/16 20:17:50.676595 ttxdwconsumer.go:358: Workflow Latest Event Time 2023-08-24 19:22:58 +0000 UTC. Workflow Target Met = true
2023/09/16 20:17:50.676612 ttxdwconsumer.go:296: Workflow eref6072406157 is CLOSED
2023/09/16 20:17:50.677223 ttxdwconsumer.go:226: Setting D2A Workflow state for Patient 6072406157
2023/09/16 20:17:50.677860 ttxdwconsumer.go:327: Workflow Started 2023-08-24 20:42:54 +0100 BST Status CLOSED
2023/09/16 20:17:50.677950 ttxdwconsumer.go:330: Time Now 2023-09-16 20:17:50.677947 +0100 BST
2023/09/16 20:17:50.678555 ttxdwconsumer.go:333: Workflow is Complete. Latest Event Time was 2023-08-26 15:06:08 +0000 UTC
2023/09/16 20:17:50.678576 ttxdwconsumer.go:336: Duration - 1 Days 19 Hrs 23 Mins
2023/09/16 20:17:50.678696 ttxdwconsumer.go:351: Checking if Workflow is Overdue
2023/09/16 20:17:50.678827 ttxdwconsumer.go:354: Workflow Complete By Date is 2023-09-13 20:42:54 +0100 BST
2023/09/16 20:17:50.679481 ttxdwconsumer.go:358: Workflow Latest Event Time 2023-08-26 15:06:08 +0000 UTC. Workflow Target Met = true
2023/09/16 20:17:50.679511 ttxdwconsumer.go:296: Workflow d2a6072406157 is CLOSED
2023/09/16 20:17:50.680193 ttxdwconsumer.go:226: Setting D2A Workflow state for Patient 6072406157
2023/09/16 20:17:50.680806 ttxdwconsumer.go:327: Workflow Started 2023-08-29 17:00:58 +0100 BST Status CLOSED
2023/09/16 20:17:50.680884 ttxdwconsumer.go:330: Time Now 2023-09-16 20:17:50.680882 +0100 BST
2023/09/16 20:17:50.683257 ttxdwconsumer.go:333: Workflow is Complete. Latest Event Time was 2023-08-29 16:03:32 +0000 UTC
2023/09/16 20:17:50.683316 ttxdwconsumer.go:336: Duration - 0 Days 0 Hrs 2 Mins
2023/09/16 20:17:50.683465 ttxdwconsumer.go:351: Checking if Workflow is Overdue
2023/09/16 20:17:50.683553 ttxdwconsumer.go:354: Workflow Complete By Date is 2023-09-18 17:00:58 +0100 BST
2023/09/16 20:17:50.683570 ttxdwconsumer.go:365: Workflow is not overdue
2023/09/16 20:17:50.683592 ttxdwconsumer.go:296: Workflow d2a6072406157 is CLOSED
2023/09/16 20:17:50.683944 ttxdwconsumer.go:226: Setting PATHALERT Workflow state for Patient 6072406157
2023/09/16 20:17:50.684560 ttxdwconsumer.go:327: Workflow Started 2023-08-29 17:20:32 +0100 BST Status CLOSED
2023/09/16 20:17:50.684631 ttxdwconsumer.go:330: Time Now 2023-09-16 20:17:50.684628 +0100 BST
2023/09/16 20:17:50.684988 ttxdwconsumer.go:333: Workflow is Complete. Latest Event Time was 2023-08-29 16:23:05 +0000 UTC
2023/09/16 20:17:50.685004 ttxdwconsumer.go:336: Duration - 0 Days 0 Hrs 2 Mins
2023/09/16 20:17:50.685082 ttxdwconsumer.go:351: Checking if Workflow is Overdue
2023/09/16 20:17:50.685158 ttxdwconsumer.go:354: Workflow Complete By Date is 2023-08-30 01:20:32 +0100 BST
2023/09/16 20:17:50.685504 ttxdwconsumer.go:358: Workflow Latest Event Time 2023-08-29 16:23:05 +0000 UTC. Workflow Target Met = true
2023/09/16 20:17:50.685759 ttxdwconsumer.go:296: Workflow pathalert6072406157 is CLOSED
2023/09/16 20:17:50.686293 ttxdwconsumer.go:226: Setting D2A Workflow state for Patient 6072406157
2023/09/16 20:17:50.686863 ttxdwconsumer.go:327: Workflow Started 2023-08-30 10:21:36 +0100 BST Status CLOSED
2023/09/16 20:17:50.686934 ttxdwconsumer.go:330: Time Now 2023-09-16 20:17:50.686931 +0100 BST
2023/09/16 20:17:50.687375 ttxdwconsumer.go:333: Workflow is Complete. Latest Event Time was 2023-08-30 09:36:38 +0000 UTC
2023/09/16 20:17:50.687392 ttxdwconsumer.go:336: Duration - 0 Days 0 Hrs 15 Mins
2023/09/16 20:17:50.687473 ttxdwconsumer.go:351: Checking if Workflow is Overdue
2023/09/16 20:17:50.687542 ttxdwconsumer.go:354: Workflow Complete By Date is 2023-09-19 10:21:36 +0100 BST
2023/09/16 20:17:50.687564 ttxdwconsumer.go:365: Workflow is not overdue
2023/09/16 20:17:50.687583 ttxdwconsumer.go:296: Workflow d2a6072406157 is CLOSED
2023/09/16 20:17:50.688104 ttxdwconsumer.go:226: Setting D2A Workflow state for Patient 6072406157
2023/09/16 20:17:50.688588 ttxdwconsumer.go:327: Workflow Started 2023-08-30 10:39:37 +0100 BST Status CLOSED
2023/09/16 20:17:50.688661 ttxdwconsumer.go:330: Time Now 2023-09-16 20:17:50.688659 +0100 BST
2023/09/16 20:17:50.688989 ttxdwconsumer.go:333: Workflow is Complete. Latest Event Time was 2023-08-30 11:31:20 +0000 UTC
2023/09/16 20:17:50.689001 ttxdwconsumer.go:336: Duration - 0 Days 1 Hrs 51 Mins
2023/09/16 20:17:50.689061 ttxdwconsumer.go:351: Checking if Workflow is Overdue
2023/09/16 20:17:50.689122 ttxdwconsumer.go:354: Workflow Complete By Date is 2023-09-19 10:39:37 +0100 BST
2023/09/16 20:17:50.689133 ttxdwconsumer.go:365: Workflow is not overdue
2023/09/16 20:17:50.689148 ttxdwconsumer.go:296: Workflow d2a6072406157 is CLOSED
2023/09/16 20:17:50.689534 ttxdwconsumer.go:226: Setting D2A Workflow state for Patient 6072406157
2023/09/16 20:17:50.689917 ttxdwconsumer.go:327: Workflow Started 2023-09-03 15:33:30 +0100 BST Status CLOSED
2023/09/16 20:17:50.689980 ttxdwconsumer.go:330: Time Now 2023-09-16 20:17:50.689978 +0100 BST
2023/09/16 20:17:50.690317 ttxdwconsumer.go:333: Workflow is Complete. Latest Event Time was 2023-09-05 14:42:19 +0100 BST
2023/09/16 20:17:50.690330 ttxdwconsumer.go:336: Duration - 1 Days 23 Hrs 8 Mins
2023/09/16 20:17:50.690388 ttxdwconsumer.go:351: Checking if Workflow is Overdue
2023/09/16 20:17:50.690443 ttxdwconsumer.go:354: Workflow Complete By Date is 2023-09-23 15:33:30 +0100 BST
2023/09/16 20:17:50.690454 ttxdwconsumer.go:365: Workflow is not overdue
2023/09/16 20:17:50.690469 ttxdwconsumer.go:296: Workflow d2a6072406157 is CLOSED
2023/09/16 20:17:50.690864 ttxdwconsumer.go:226: Setting TOC Workflow state for Patient 6072406157
2023/09/16 20:17:50.691348 ttxdwconsumer.go:327: Workflow Started 2023-09-09 09:47:48 +0100 BST Status CLOSED
2023/09/16 20:17:50.691410 ttxdwconsumer.go:330: Time Now 2023-09-16 20:17:50.691408 +0100 BST
2023/09/16 20:17:50.691733 ttxdwconsumer.go:333: Workflow is Complete. Latest Event Time was 2023-09-09 08:52:24 +0000 UTC
2023/09/16 20:17:50.691749 ttxdwconsumer.go:336: Duration - 0 Days 0 Hrs 4 Mins
2023/09/16 20:17:50.691817 ttxdwconsumer.go:351: Checking if Workflow is Overdue
2023/09/16 20:17:50.691876 ttxdwconsumer.go:354: Workflow Complete By Date is 2023-09-14 09:47:48 +0100 BST
2023/09/16 20:17:50.692379 ttxdwconsumer.go:358: Workflow Latest Event Time 2023-09-09 08:52:24 +0000 UTC. Workflow Target Met = true
2023/09/16 20:17:50.692463 ttxdwconsumer.go:296: Workflow toc6072406157 is CLOSED
2023/09/16 20:17:50.693092 ttxdwconsumer.go:226: Setting D2A Workflow state for Patient 6072406157
2023/09/16 20:17:50.693760 ttxdwconsumer.go:327: Workflow Started 2023-09-11 20:25:32 +0100 BST Status CLOSED
2023/09/16 20:17:50.693866 ttxdwconsumer.go:330: Time Now 2023-09-16 20:17:50.693862 +0100 BST
2023/09/16 20:17:50.694252 ttxdwconsumer.go:333: Workflow is Complete. Latest Event Time was 2023-09-11 19:52:17 +0000 UTC
2023/09/16 20:17:50.694271 ttxdwconsumer.go:336: Duration - 0 Days 0 Hrs 26 Mins
2023/09/16 20:17:50.694344 ttxdwconsumer.go:351: Checking if Workflow is Overdue
2023/09/16 20:17:50.694414 ttxdwconsumer.go:354: Workflow Complete By Date is 2023-10-01 20:25:32 +0100 BST
2023/09/16 20:17:50.694427 ttxdwconsumer.go:365: Workflow is not overdue
2023/09/16 20:17:50.694446 ttxdwconsumer.go:296: Workflow d2a6072406157 is CLOSED
2023/09/16 20:17:50.694861 ttxdwconsumer.go:226: Setting D2A Workflow state for Patient 6072406157
2023/09/16 20:17:50.695090 ttxdwconsumer.go:327: Workflow Started 2023-09-12 22:32:28 +0100 BST Status OPEN
2023/09/16 20:17:50.695155 ttxdwconsumer.go:330: Time Now 2023-09-16 20:17:50.695153 +0100 BST
2023/09/16 20:17:50.695169 ttxdwconsumer.go:336: Duration - 3 Days 21 Hrs 45 Mins
2023/09/16 20:17:50.695239 ttxdwconsumer.go:342: Completion time 2023-10-02 22:32:28 +0100 BST
2023/09/16 20:17:50.695253 ttxdwconsumer.go:347: Workflow Time Remaining : 386h14m37.304749s
2023/09/16 20:17:50.695335 ttxdwconsumer.go:351: Checking if Workflow is Overdue
2023/09/16 20:17:50.695400 ttxdwconsumer.go:354: Workflow Complete By Date is 2023-10-02 22:32:28 +0100 BST
2023/09/16 20:17:50.695412 ttxdwconsumer.go:365: Workflow is not overdue
2023/09/16 20:17:50.695442 ttxdwconsumer.go:286: Workflow d2a6072406157 is OPEN
2023/09/16 20:17:50.695463 ttxdwconsumer.go:381: No Escalate time defined for Workflow
2023/09/16 20:17:50.695673 tttmplts.go:87: Processing Template wfstate2t_tmplt
2023/09/16 20:17:50.776218 ttproxy.go:149: Response Status Code 200
2023/09/16 20:37:35.297166 ttserver.go:52: ICB Workflow Service stopped
