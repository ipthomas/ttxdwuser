2023/09/16 15:02:58.472604 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:02:58.473010 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:02:58.473138 ttdb.go:54: Opened Database
2023/09/16 15:02:58.657125 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:02:58.721286 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:02:58.721348 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:02:58.786003 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:02:58.883053 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:02:58.883082 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:02:58.947344 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:02:59.014487 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:02:59.014647 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:02:59.080213 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:02:59.147581 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:02:59.147641 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:02:59.212148 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:02:59.277351 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:02:59.277398 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:02:59.342779 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:02:59.461500 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:02:59.461652 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:02:59.524752 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:02:59.589610 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:02:59.589696 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:02:59.654094 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:02:59.717423 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:02:59.717453 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:02:59.781434 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:02:59.849517 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:02:59.849555 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:02:59.926140 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:03:00.234172 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:03:00.234246 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:03:00.325353 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:03:00.405809 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:03:00.405962 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:03:00.492903 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:03:00.579942 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:03:00.580015 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:03:00.645819 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:03:00.717667 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:03:00.717827 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:03:00.782633 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:03:00.874650 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:03:00.874825 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:03:01.015919 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:03:01.082080 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:03:01.082249 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:03:01.147879 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:03:01.212332 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:03:01.212362 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:03:01.279905 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:03:01.348021 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:03:01.348162 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:03:01.413279 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:03:01.480212 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:03:01.480369 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:03:01.551224 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:03:01.620475 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:03:01.620607 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:03:01.685294 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:03:01.754660 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:03:01.754785 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:03:01.819321 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:03:01.888199 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:03:01.888342 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:03:01.954808 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:03:02.019755 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:03:02.019894 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:03:02.020235 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:03:05.048703 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:03:05.048834 ttproxy.go:138: 	Request Query Params
2023/09/16 15:03:05.049157 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:03:05.049194 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:03:05.049244 tttmplts.go:37: CGL Worker starting
2023/09/16 15:03:05.049241 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:03:05.049424 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:03:05.050698 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:03:05.050771 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:03:05.225736 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:03:05.230932 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:03:05.231359 tttmplts.go:39: CGL Worker done
2023/09/16 15:03:05.231410 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:03:10.051373 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:03:10.051656 tttmplts.go:32: PIXm Worker done
2023/09/16 15:03:10.051718 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:03:10.052022 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:03:10.052197 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[f548d984-af6d-49e9-b65a-beb8210ab4a1]]
2023/09/16 15:03:10.293305 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:03:10.644193 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:03:10.649586 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:03:10.718762 tttmplts.go:93: template: pdsretrieve_tmplt:185:53: executing "pdsretrieve_tmplt" at <$ext.valueCodeableConcept.Coding>: can't evaluate field valueCodeableConcept in type struct { URL string "json:\"url,omitempty\""; ValueReference struct { Identifier struct { System string "json:\"system,omitempty\""; Value string "json:\"value,omitempty\"" } "json:\"identifier,omitempty\"" } "json:\"valueReference,omitempty\""; Extension []struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" } "json:\"extension,omitempty\""; ValueAddress struct { City string "json:\"city,omitempty\""; District string "json:\"district,omitempty\""; Country string "json:\"country,omitempty\"" } "json:\"valueAddress,omitempty\"" }
2023/09/16 15:03:10.719207 ttproxy.go:105: template: pdsretrieve_tmplt:185:53: executing "pdsretrieve_tmplt" at <$ext.valueCodeableConcept.Coding>: can't evaluate field valueCodeableConcept in type struct { URL string "json:\"url,omitempty\""; ValueReference struct { Identifier struct { System string "json:\"system,omitempty\""; Value string "json:\"value,omitempty\"" } "json:\"identifier,omitempty\"" } "json:\"valueReference,omitempty\""; Extension []struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" } "json:\"extension,omitempty\""; ValueAddress struct { City string "json:\"city,omitempty\""; District string "json:\"district,omitempty\""; Country string "json:\"country,omitempty\"" } "json:\"valueAddress,omitempty\"" }
2023/09/16 15:03:10.719279 ttproxy.go:149: Response Status Code 500
2023/09/16 15:03:10.719295 ttproxy.go:151: 
2023/09/16 15:03:10.719304 ttproxy.go:152: Response Headers
2023/09/16 15:03:10.719434 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:03:10.719450 ttproxy.go:154: ----------------
2023/09/16 15:03:10.719458 ttproxy.go:155: Response
2023/09/16 15:03:10.719465 ttproxy.go:156: ----------------
2023/09/16 15:03:10.719790 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:51936",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:03:10.719823 ttproxy.go:158: -------------
2023/09/16 15:03:10.719845 ttproxy.go:160: Error template: pdsretrieve_tmplt:185:53: executing "pdsretrieve_tmplt" at <$ext.valueCodeableConcept.Coding>: can't evaluate field valueCodeableConcept in type struct { URL string "json:\"url,omitempty\""; ValueReference struct { Identifier struct { System string "json:\"system,omitempty\""; Value string "json:\"value,omitempty\"" } "json:\"identifier,omitempty\"" } "json:\"valueReference,omitempty\""; Extension []struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" } "json:\"extension,omitempty\""; ValueAddress struct { City string "json:\"city,omitempty\""; District string "json:\"district,omitempty\""; Country string "json:\"country,omitempty\"" } "json:\"valueAddress,omitempty\"" }
2023/09/16 15:03:10.719862 ttproxy.go:161: -------------
2023/09/16 15:07:05.595094 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:07:07.362022 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:07:07.362502 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:07:07.362630 ttdb.go:54: Opened Database
2023/09/16 15:07:07.558653 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:07:07.633618 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:07:07.633745 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:07:07.701626 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:07:07.807901 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:07:07.808054 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:07:07.876460 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:07:07.949731 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:07:07.949881 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:07:08.018362 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:07:08.097618 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:07:08.097772 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:07:08.169523 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:07:08.239266 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:07:08.239360 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:07:08.308354 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:07:08.439650 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:07:08.439839 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:07:08.510031 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:07:08.581857 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:07:08.581903 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:07:08.650953 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:07:08.720175 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:07:08.720196 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:07:08.790461 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:07:08.863432 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:07:08.863583 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:07:08.933506 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:07:09.004273 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:07:09.004326 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:07:09.080387 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:07:09.163484 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:07:09.163639 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:07:09.232882 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:07:09.317318 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:07:09.317468 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:07:09.386484 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:07:09.464915 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:07:09.465068 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:07:09.533166 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:07:09.605116 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:07:09.605242 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:07:09.674852 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:07:09.745712 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:07:09.745942 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:07:09.816209 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:07:09.892980 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:07:09.893115 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:07:09.962159 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:07:10.035299 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:07:10.035433 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:07:10.110175 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:07:10.183896 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:07:10.184055 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:07:10.253678 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:07:10.326537 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:07:10.326619 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:07:10.396183 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:07:10.472844 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:07:10.472957 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:07:10.546417 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:07:10.622448 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:07:10.622581 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:07:10.692876 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:07:10.764293 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:07:10.764420 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:07:10.764671 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:07:13.480450 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:07:13.480596 ttproxy.go:138: 	Request Query Params
2023/09/16 15:07:13.480941 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:07:13.480999 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:07:13.481036 tttmplts.go:37: CGL Worker starting
2023/09/16 15:07:13.481041 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:07:13.481530 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:07:13.482721 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:07:13.482798 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:07:13.656628 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:07:13.661247 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:07:13.661357 tttmplts.go:39: CGL Worker done
2023/09/16 15:07:13.661380 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:07:18.483199 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:07:18.483566 tttmplts.go:32: PIXm Worker done
2023/09/16 15:07:18.483623 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:07:18.483801 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:07:18.483970 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[a99686c8-ac1d-4558-9d8d-5389c88b15dc]]
2023/09/16 15:07:18.644008 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:07:18.850674 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:07:18.856516 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:07:18.929862 tttmplts.go:93: template: pdsretrieve_tmplt:185:53: executing "pdsretrieve_tmplt" at <$ext.ValueCodeableConcept.Coding>: can't evaluate field ValueCodeableConcept in type struct { URL string "json:\"url,omitempty\""; ValueReference struct { Identifier struct { System string "json:\"system,omitempty\""; Value string "json:\"value,omitempty\"" } "json:\"identifier,omitempty\"" } "json:\"valueReference,omitempty\""; Extension []struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" } "json:\"extension,omitempty\""; ValueAddress struct { City string "json:\"city,omitempty\""; District string "json:\"district,omitempty\""; Country string "json:\"country,omitempty\"" } "json:\"valueAddress,omitempty\"" }
2023/09/16 15:07:18.930125 ttproxy.go:105: template: pdsretrieve_tmplt:185:53: executing "pdsretrieve_tmplt" at <$ext.ValueCodeableConcept.Coding>: can't evaluate field ValueCodeableConcept in type struct { URL string "json:\"url,omitempty\""; ValueReference struct { Identifier struct { System string "json:\"system,omitempty\""; Value string "json:\"value,omitempty\"" } "json:\"identifier,omitempty\"" } "json:\"valueReference,omitempty\""; Extension []struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" } "json:\"extension,omitempty\""; ValueAddress struct { City string "json:\"city,omitempty\""; District string "json:\"district,omitempty\""; Country string "json:\"country,omitempty\"" } "json:\"valueAddress,omitempty\"" }
2023/09/16 15:07:18.930258 ttproxy.go:149: Response Status Code 500
2023/09/16 15:07:18.930274 ttproxy.go:151: 
2023/09/16 15:07:18.930283 ttproxy.go:152: Response Headers
2023/09/16 15:07:18.930382 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:07:18.930404 ttproxy.go:154: ----------------
2023/09/16 15:07:18.930417 ttproxy.go:155: Response
2023/09/16 15:07:18.930424 ttproxy.go:156: ----------------
2023/09/16 15:07:18.930827 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52007",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:07:18.930862 ttproxy.go:158: -------------
2023/09/16 15:07:18.930871 ttproxy.go:160: Error template: pdsretrieve_tmplt:185:53: executing "pdsretrieve_tmplt" at <$ext.ValueCodeableConcept.Coding>: can't evaluate field ValueCodeableConcept in type struct { URL string "json:\"url,omitempty\""; ValueReference struct { Identifier struct { System string "json:\"system,omitempty\""; Value string "json:\"value,omitempty\"" } "json:\"identifier,omitempty\"" } "json:\"valueReference,omitempty\""; Extension []struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" } "json:\"extension,omitempty\""; ValueAddress struct { City string "json:\"city,omitempty\""; District string "json:\"district,omitempty\""; Country string "json:\"country,omitempty\"" } "json:\"valueAddress,omitempty\"" }
2023/09/16 15:07:18.930898 ttproxy.go:161: -------------
2023/09/16 15:16:47.913106 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:16:49.653499 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:16:49.654022 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:16:49.654163 ttdb.go:54: Opened Database
2023/09/16 15:16:49.866707 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:16:49.932474 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:16:49.932542 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:16:49.998151 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:16:50.098665 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:16:50.098700 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:16:50.163816 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:16:50.233140 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:16:50.233198 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:16:50.298814 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:16:50.364164 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:16:50.364324 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:16:50.429764 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:16:50.496656 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:16:50.496792 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:16:50.561666 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:16:50.681952 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:16:50.682192 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:16:50.749686 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:16:50.817533 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:16:50.817679 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:16:50.884938 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:16:50.954867 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:16:50.955062 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:16:51.022237 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:16:51.096225 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:16:51.096370 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:16:51.162260 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:16:51.229310 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:16:51.229485 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:16:51.297475 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:16:51.378991 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:16:51.379034 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:16:51.443838 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:16:51.522539 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:16:51.522695 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:16:51.587534 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:16:51.659847 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:16:51.659975 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:16:51.746735 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:16:51.811451 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:16:51.811568 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:16:51.877745 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:16:51.945234 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:16:51.945375 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:16:52.010777 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:16:52.075980 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:16:52.076123 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:16:52.141859 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:16:52.212795 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:16:52.212926 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:16:52.278249 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:16:52.358637 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:16:52.358749 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:16:52.498042 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:16:52.632068 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:16:52.632207 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:16:52.757498 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:16:52.871410 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:16:52.871543 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:16:52.952108 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:16:53.093552 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:16:53.093675 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:16:53.197968 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:16:53.363635 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:16:53.363694 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:16:53.363966 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:16:55.984661 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:16:55.984850 ttproxy.go:138: 	Request Query Params
2023/09/16 15:16:55.985302 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:16:55.985334 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:16:55.985380 tttmplts.go:37: CGL Worker starting
2023/09/16 15:16:55.985384 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:16:55.985666 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:16:55.987276 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:16:55.987305 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:16:56.152838 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:16:56.155666 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:16:56.155794 tttmplts.go:39: CGL Worker done
2023/09/16 15:16:56.155817 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:17:00.987225 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:17:00.987737 tttmplts.go:32: PIXm Worker done
2023/09/16 15:17:00.987805 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:17:00.987965 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:17:00.988131 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[2c74bb12-c745-4162-8c76-15a70fd7564d]]
2023/09/16 15:17:01.184046 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:17:01.382575 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:17:01.386481 tttmplts.go:104: Template pdsretrieve_tmplt caused Error template: pdsretrieve_tmplt:196: unexpected EOF
2023/09/16 15:17:01.387053 server.go:3217: http: panic serving [::1]:52190: runtime error: invalid memory address or nil pointer dereference
goroutine 52 [running]:
net/http.(*conn).serve.func1()
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1854 +0xbf
panic({0x1434ca0, 0x17e4e70})
	/Users/IanThomas/sdk/go1.20.5/src/runtime/panic.go:890 +0x263
html/template.(*Template).New(0x14c1682?, {0xc000028540?, 0xc0001e1fc0?})
	/Users/IanThomas/sdk/go1.20.5/src/html/template/template.go:305 +0x37
main.(*Trans).cacheTemplates(0xc000402000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:103 +0x1d2
main.(*Trans).setResponseFromTemplate(0xc000402000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:85 +0x45
main.(*Trans).setPatientTemplate(0xc000402000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:53 +0x1b1
main.(*Trans).newGetHandler(0xc000402000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttgethandler.go:28 +0xd94
main.(*Trans).newProxyTrans(0xc000402000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:73 +0x4d1
main.Handle_HTTP_Request({0x15657d0, 0xc00009e7e0}, 0xc0000ea000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:15 +0xeb
net/http.HandlerFunc.ServeHTTP(0xc0000ec01f?, {0x15657d0?, 0xc00009e7e0?}, 0x1064cee?)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2122 +0x2f
net/http.serverHandler.ServeHTTP({0xc0000a2420?}, {0x15657d0, 0xc00009e7e0}, 0xc0000ea000)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2936 +0x316
net/http.(*conn).serve(0xc0002962d0, {0x15659c8, 0xc0002923c0})
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1995 +0x612
created by net/http.(*Server).Serve
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:3089 +0x5ed
2023/09/16 15:17:31.268666 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:17:34.061798 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:17:34.062177 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:17:34.062315 ttdb.go:54: Opened Database
2023/09/16 15:17:34.573807 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:17:34.692799 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:17:34.692963 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:17:34.790646 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:17:35.019170 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:17:35.019315 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:17:35.140893 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:17:35.261044 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:17:35.261220 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:17:35.426340 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:17:35.505643 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:17:35.505833 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:17:35.627689 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:17:35.701600 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:17:35.701746 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:17:35.845547 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:17:36.051793 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:17:36.051955 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:17:36.178486 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:17:36.293104 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:17:36.293297 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:17:36.421103 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:17:36.556980 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:17:36.557142 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:17:36.698878 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:17:36.768194 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:17:36.768323 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:17:36.877862 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:17:36.981762 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:17:36.981919 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:17:37.105420 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:17:37.245207 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:17:37.245349 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:17:37.374321 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:17:37.550628 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:17:37.550794 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:17:37.662706 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:17:37.773544 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:17:37.773692 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:17:37.894569 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:17:38.005702 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:17:38.005855 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:17:38.092342 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:17:38.228796 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:17:38.228920 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:17:38.357197 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:17:38.426798 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:17:38.426924 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:17:38.586656 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:17:38.693191 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:17:38.693323 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:17:38.764000 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:17:38.880839 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:17:38.880976 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:17:38.947653 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:17:39.027590 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:17:39.027723 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:17:39.108419 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:17:39.185255 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:17:39.185381 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:17:39.252896 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:17:39.327670 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:17:39.327802 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:17:39.394236 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:17:39.463700 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:17:39.463919 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:17:39.464184 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:17:42.323031 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:17:42.323171 ttproxy.go:138: 	Request Query Params
2023/09/16 15:17:42.323496 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:17:42.323523 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:17:42.323553 tttmplts.go:37: CGL Worker starting
2023/09/16 15:17:42.323560 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:17:42.324011 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:17:42.325195 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:17:42.325444 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:17:42.486755 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:17:42.491619 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:17:42.491685 tttmplts.go:39: CGL Worker done
2023/09/16 15:17:42.491707 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:17:47.317039 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:17:47.317611 tttmplts.go:32: PIXm Worker done
2023/09/16 15:17:47.317672 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:17:47.317859 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:17:47.317974 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[62515d06-61ae-4ab6-bdf2-2075834b32f2]]
2023/09/16 15:17:47.568148 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:17:47.908726 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:17:47.912917 tttmplts.go:104: Template pdsretrieve_tmplt caused Error template: pdsretrieve_tmplt:197: unexpected EOF
2023/09/16 15:17:47.913569 server.go:3217: http: panic serving [::1]:52209: runtime error: invalid memory address or nil pointer dereference
goroutine 21 [running]:
net/http.(*conn).serve.func1()
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1854 +0xbf
panic({0x1434ca0, 0x17e4e70})
	/Users/IanThomas/sdk/go1.20.5/src/runtime/panic.go:890 +0x263
html/template.(*Template).New(0x14c1682?, {0xc0000a0150?, 0xc0004d9fc0?})
	/Users/IanThomas/sdk/go1.20.5/src/html/template/template.go:305 +0x37
main.(*Trans).cacheTemplates(0xc000404000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:103 +0x1d2
main.(*Trans).setResponseFromTemplate(0xc000404000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:85 +0x45
main.(*Trans).setPatientTemplate(0xc000404000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:53 +0x1b1
main.(*Trans).newGetHandler(0xc000404000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttgethandler.go:28 +0xd94
main.(*Trans).newProxyTrans(0xc000404000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:73 +0x4d1
main.Handle_HTTP_Request({0x15657d0, 0xc00028d260}, 0xc0002f4000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:15 +0xeb
net/http.HandlerFunc.ServeHTTP(0xc00003416f?, {0x15657d0?, 0xc00028d260?}, 0x1064cee?)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2122 +0x2f
net/http.serverHandler.ServeHTTP({0xc00007c990?}, {0x15657d0, 0xc00028d260}, 0xc0002f4000)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2936 +0x316
net/http.(*conn).serve(0xc000120fc0, {0x15659c8, 0xc000117290})
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1995 +0x612
created by net/http.(*Server).Serve
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:3089 +0x5ed
2023/09/16 15:19:32.552613 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:19:33.896836 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:19:33.897342 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:19:33.897479 ttdb.go:54: Opened Database
2023/09/16 15:19:34.080706 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:19:34.146118 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:19:34.146207 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:19:34.212462 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:19:34.315182 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:19:34.315223 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:19:34.380899 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:19:34.448966 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:19:34.449137 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:19:34.514895 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:19:34.580979 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:19:34.581048 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:19:34.649879 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:19:34.715335 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:19:34.715446 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:19:34.783408 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:19:34.907725 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:19:34.907915 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:19:34.973642 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:19:35.040945 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:19:35.041127 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:19:35.107975 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:19:35.174381 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:19:35.174538 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:19:35.243037 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:19:35.314411 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:19:35.314607 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:19:35.382029 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:19:35.449284 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:19:35.449457 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:19:35.518659 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:19:35.596724 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:19:35.596813 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:19:35.677266 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:19:35.759835 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:19:35.759894 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:19:35.826947 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:19:35.900540 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:19:35.900650 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:19:35.969294 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:19:36.036332 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:19:36.036493 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:19:36.102491 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:19:36.169365 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:19:36.169491 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:19:36.235982 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:19:36.302750 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:19:36.302855 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:19:36.371543 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:19:36.442536 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:19:36.442676 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:19:36.508947 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:19:36.579985 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:19:36.580135 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:19:36.647730 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:19:36.718112 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:19:36.718261 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:19:36.784045 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:19:36.860401 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:19:36.860556 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:19:36.926464 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:19:37.000348 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:19:37.000504 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:19:37.069783 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:19:37.137574 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:19:37.137726 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:19:37.137980 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:19:39.990154 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:19:39.990311 ttproxy.go:138: 	Request Query Params
2023/09/16 15:19:39.990656 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:19:39.990697 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:19:39.990737 tttmplts.go:37: CGL Worker starting
2023/09/16 15:19:39.990751 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:19:39.991261 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:19:39.993010 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:19:39.993496 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:19:40.415117 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:19:40.421174 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:19:40.421311 tttmplts.go:39: CGL Worker done
2023/09/16 15:19:40.421350 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:19:44.992617 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:19:44.993297 tttmplts.go:32: PIXm Worker done
2023/09/16 15:19:44.993372 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:19:44.993566 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:19:44.993719 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[e2b3a8c0-3a81-4db9-b057-a2c453e92178]]
2023/09/16 15:19:45.123342 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:19:45.319238 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:19:45.325020 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:19:45.394840 tttmplts.go:93: template: pdsretrieve_tmplt:179:37: executing "pdsretrieve_tmplt" at <gt .ValueCodeableConcept.Coding 0>: error calling gt: invalid type for comparison
2023/09/16 15:19:45.395124 ttproxy.go:105: template: pdsretrieve_tmplt:179:37: executing "pdsretrieve_tmplt" at <gt .ValueCodeableConcept.Coding 0>: error calling gt: invalid type for comparison
2023/09/16 15:19:45.395183 ttproxy.go:149: Response Status Code 500
2023/09/16 15:19:45.395200 ttproxy.go:151: 
2023/09/16 15:19:45.395212 ttproxy.go:152: Response Headers
2023/09/16 15:19:45.395311 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:19:45.395330 ttproxy.go:154: ----------------
2023/09/16 15:19:45.395343 ttproxy.go:155: Response
2023/09/16 15:19:45.395353 ttproxy.go:156: ----------------
2023/09/16 15:19:45.395716 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52232",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:19:45.395757 ttproxy.go:158: -------------
2023/09/16 15:19:45.395772 ttproxy.go:160: Error template: pdsretrieve_tmplt:179:37: executing "pdsretrieve_tmplt" at <gt .ValueCodeableConcept.Coding 0>: error calling gt: invalid type for comparison
2023/09/16 15:19:45.395787 ttproxy.go:161: -------------
2023/09/16 15:20:55.329045 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:20:57.098616 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:20:57.099103 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:20:57.099244 ttdb.go:54: Opened Database
2023/09/16 15:20:57.279120 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:20:57.344763 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:20:57.344832 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:20:57.409409 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:20:57.508248 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:20:57.508293 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:20:57.575353 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:20:57.644697 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:20:57.644841 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:20:57.708195 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:20:57.777322 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:20:57.777473 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:20:57.841999 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:20:57.907573 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:20:57.907626 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:20:57.972963 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:20:58.094607 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:20:58.094765 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:20:58.158936 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:20:58.224698 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:20:58.224777 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:20:58.293892 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:20:58.358938 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:20:58.359043 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:20:58.424684 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:20:58.493245 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:20:58.493416 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:20:58.560074 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:20:58.630472 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:20:58.630652 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:20:58.696895 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:20:58.778587 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:20:58.778806 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:20:58.845482 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:20:58.926616 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:20:58.926669 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:20:58.991031 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:20:59.059311 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:20:59.059351 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:20:59.123152 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:20:59.187440 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:20:59.187588 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:20:59.250864 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:20:59.315804 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:20:59.315935 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:20:59.380121 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:20:59.443315 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:20:59.443455 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:20:59.506632 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:20:59.572533 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:20:59.572670 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:20:59.635877 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:20:59.703095 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:20:59.703297 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:20:59.772826 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:20:59.968094 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:20:59.968242 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:21:00.211893 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:21:00.323998 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:21:00.324171 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:21:00.451349 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:21:00.568167 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:21:00.568320 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:21:00.732465 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:21:00.877814 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:21:00.877979 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:21:00.878765 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:21:04.199553 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:21:04.199723 ttproxy.go:138: 	Request Query Params
2023/09/16 15:21:04.200085 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:21:04.200129 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:21:04.200174 tttmplts.go:37: CGL Worker starting
2023/09/16 15:21:04.200175 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:21:04.200638 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:21:04.201922 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:21:04.201995 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:21:04.379344 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:21:04.384716 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:21:04.384868 tttmplts.go:39: CGL Worker done
2023/09/16 15:21:04.384915 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:21:09.201673 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:21:09.202203 tttmplts.go:32: PIXm Worker done
2023/09/16 15:21:09.202318 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:21:09.202616 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:21:09.202767 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[f287f476-6e52-4908-88d5-2ae970acb541]]
2023/09/16 15:21:09.422312 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:21:09.612645 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:21:09.618208 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:21:09.686891 tttmplts.go:93: template: pdsretrieve_tmplt:182:78: executing "pdsretrieve_tmplt" at <.ValueCodeableConcept.Coding.Display>: can't evaluate field Display in type []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" }
2023/09/16 15:21:09.687142 ttproxy.go:105: template: pdsretrieve_tmplt:182:78: executing "pdsretrieve_tmplt" at <.ValueCodeableConcept.Coding.Display>: can't evaluate field Display in type []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" }
2023/09/16 15:21:09.687217 ttproxy.go:149: Response Status Code 500
2023/09/16 15:21:09.687239 ttproxy.go:151: 
2023/09/16 15:21:09.687253 ttproxy.go:152: Response Headers
2023/09/16 15:21:09.687382 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:21:09.687408 ttproxy.go:154: ----------------
2023/09/16 15:21:09.687419 ttproxy.go:155: Response
2023/09/16 15:21:09.687429 ttproxy.go:156: ----------------
2023/09/16 15:21:09.687755 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52260",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:21:09.687784 ttproxy.go:158: -------------
2023/09/16 15:21:09.687796 ttproxy.go:160: Error template: pdsretrieve_tmplt:182:78: executing "pdsretrieve_tmplt" at <.ValueCodeableConcept.Coding.Display>: can't evaluate field Display in type []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" }
2023/09/16 15:21:09.687808 ttproxy.go:161: -------------
2023/09/16 15:23:50.759656 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:23:52.452523 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:23:52.452975 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:23:52.453084 ttdb.go:54: Opened Database
2023/09/16 15:23:52.640868 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:23:52.705184 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:23:52.705234 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:23:52.941721 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:23:53.037169 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:23:53.037296 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:23:53.099458 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:23:53.167260 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:23:53.167400 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:23:53.229815 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:23:53.293113 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:23:53.293265 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:23:53.357258 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:23:53.421412 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:23:53.421604 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:23:53.486893 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:23:53.679052 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:23:53.679240 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:23:53.745097 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:23:53.809475 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:23:53.809635 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:23:53.873037 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:23:53.936397 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:23:53.936590 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:23:54.006337 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:23:54.072361 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:23:54.072408 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:23:54.147064 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:23:54.210757 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:23:54.210972 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:23:54.275114 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:23:54.369617 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:23:54.369802 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:23:54.434338 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:23:54.532523 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:23:54.532754 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:23:54.597655 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:23:54.666930 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:23:54.667066 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:23:54.730228 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:23:54.795317 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:23:54.795516 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:23:54.858767 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:23:54.921873 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:23:54.922063 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:23:54.987137 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:23:55.051835 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:23:55.052012 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:23:55.116784 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:23:55.183190 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:23:55.183280 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:23:55.245791 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:23:55.313128 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:23:55.313254 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:23:55.376135 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:23:55.442141 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:23:55.442283 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:23:55.505804 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:23:55.576153 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:23:55.576300 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:23:55.638640 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:23:55.707552 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:23:55.707698 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:23:55.769705 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:23:55.834604 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:23:55.834756 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:23:55.835053 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:23:58.682261 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:23:58.682423 ttproxy.go:138: 	Request Query Params
2023/09/16 15:23:58.682787 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:23:58.682829 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:23:58.682875 tttmplts.go:37: CGL Worker starting
2023/09/16 15:23:58.682881 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:23:58.683373 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:23:58.684586 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:23:58.684651 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:23:58.870502 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:23:58.876691 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:23:58.876812 tttmplts.go:39: CGL Worker done
2023/09/16 15:23:58.876845 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:24:03.684087 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:24:03.684372 tttmplts.go:32: PIXm Worker done
2023/09/16 15:24:03.684415 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:24:03.684675 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:24:03.684855 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[c7728526-29c1-4163-9737-8961e7b7e508]]
2023/09/16 15:24:03.959540 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:24:04.270166 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:24:04.276057 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:24:04.372871 tttmplts.go:93: template: pdsretrieve_tmplt:183:104: executing "pdsretrieve_tmplt" at <.ValueCodeableConcept.Coding.Display>: can't evaluate field ValueCodeableConcept in type struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" }
2023/09/16 15:24:04.373132 ttproxy.go:105: template: pdsretrieve_tmplt:183:104: executing "pdsretrieve_tmplt" at <.ValueCodeableConcept.Coding.Display>: can't evaluate field ValueCodeableConcept in type struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" }
2023/09/16 15:24:04.373194 ttproxy.go:149: Response Status Code 500
2023/09/16 15:24:04.373214 ttproxy.go:151: 
2023/09/16 15:24:04.373225 ttproxy.go:152: Response Headers
2023/09/16 15:24:04.373332 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:24:04.373347 ttproxy.go:154: ----------------
2023/09/16 15:24:04.373355 ttproxy.go:155: Response
2023/09/16 15:24:04.373362 ttproxy.go:156: ----------------
2023/09/16 15:24:04.373736 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52310",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:24:04.373776 ttproxy.go:158: -------------
2023/09/16 15:24:04.373786 ttproxy.go:160: Error template: pdsretrieve_tmplt:183:104: executing "pdsretrieve_tmplt" at <.ValueCodeableConcept.Coding.Display>: can't evaluate field ValueCodeableConcept in type struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" }
2023/09/16 15:24:04.373794 ttproxy.go:161: -------------
2023/09/16 15:24:24.334869 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:24:25.774910 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:24:25.775402 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:24:25.775534 ttdb.go:54: Opened Database
2023/09/16 15:24:25.950838 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:24:26.014158 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:24:26.014224 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:24:26.078520 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:24:26.171949 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:24:26.171981 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:24:26.234719 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:24:26.302717 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:24:26.302853 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:24:26.365214 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:24:26.427609 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:24:26.427758 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:24:26.491780 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:24:26.555348 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:24:26.555551 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:24:26.619758 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:24:26.735042 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:24:26.735167 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:24:26.798655 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:24:26.863612 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:24:26.863720 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:24:26.928258 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:24:26.993220 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:24:26.993376 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:24:27.059497 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:24:27.126023 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:24:27.126169 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:24:27.198897 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:24:27.262826 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:24:27.262987 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:24:27.326774 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:24:27.403425 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:24:27.403466 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:24:27.469200 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:24:27.548177 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:24:27.548279 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:24:27.610368 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:24:27.681504 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:24:27.681654 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:24:27.745546 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:24:27.807692 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:24:27.807749 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:24:27.870126 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:24:27.934116 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:24:27.934253 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:24:27.997267 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:24:28.060477 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:24:28.060623 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:24:28.124030 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:24:28.190880 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:24:28.191026 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:24:28.254213 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:24:28.319558 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:24:28.319700 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:24:28.383268 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:24:28.451232 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:24:28.451373 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:24:28.513778 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:24:28.587033 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:24:28.587513 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:24:28.652645 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:24:28.719960 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:24:28.720180 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:24:28.782864 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:24:28.846832 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:24:28.846985 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:24:28.847292 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:24:31.699100 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:24:31.699307 ttproxy.go:138: 	Request Query Params
2023/09/16 15:24:31.699671 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:24:31.699718 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:24:31.699777 tttmplts.go:37: CGL Worker starting
2023/09/16 15:24:31.699781 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:24:31.700263 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:24:31.701501 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:24:31.701528 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:24:31.875390 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:24:31.879106 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:24:31.879230 tttmplts.go:39: CGL Worker done
2023/09/16 15:24:31.879264 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:24:36.701748 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:24:36.702206 tttmplts.go:32: PIXm Worker done
2023/09/16 15:24:36.702266 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:24:36.702541 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:24:36.702691 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[383fa826-70dc-4d69-93f1-8445ba07935e]]
2023/09/16 15:24:37.069063 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:24:37.432605 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:24:37.441466 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:24:37.529442 ttproxy.go:149: Response Status Code 200
2023/09/16 15:27:44.786490 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:27:46.357203 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:27:46.357689 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:27:46.357828 ttdb.go:54: Opened Database
2023/09/16 15:27:46.536559 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:27:46.599578 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:27:46.599636 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:27:46.664101 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:27:46.759995 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:27:46.760028 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:27:46.824848 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:27:46.892358 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:27:46.892541 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:27:46.957996 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:27:47.022892 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:27:47.023064 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:27:47.087895 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:27:47.153212 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:27:47.154120 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:27:47.219340 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:27:47.337603 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:27:47.337757 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:27:47.401423 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:27:47.467588 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:27:47.467686 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:27:47.532547 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:27:47.596200 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:27:47.596295 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:27:47.659936 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:27:47.727435 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:27:47.727582 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:27:47.792093 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:27:47.857126 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:27:47.857206 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:27:47.921680 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:27:48.001628 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:27:48.001808 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:27:48.067325 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:27:48.148384 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:27:48.148524 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:27:48.214243 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:27:48.284465 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:27:48.284645 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:27:48.348295 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:27:48.414753 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:27:48.414798 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:27:48.479038 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:27:48.541811 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:27:48.541943 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:27:48.604909 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:27:48.669273 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:27:48.669384 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:27:48.731994 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:27:48.799107 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:27:48.799259 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:27:48.864528 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:27:48.929518 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:27:48.929675 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:27:48.995889 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:27:49.065145 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:27:49.065311 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:27:49.129977 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:27:49.205208 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:27:49.205312 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:27:49.268971 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:27:49.338231 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:27:49.338373 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:27:49.401729 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:27:49.467097 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:27:49.467246 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:27:49.467553 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:27:52.273169 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:27:52.273338 ttproxy.go:138: 	Request Query Params
2023/09/16 15:27:52.273724 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:27:52.273778 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:27:52.273838 tttmplts.go:37: CGL Worker starting
2023/09/16 15:27:52.273838 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:27:52.274665 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:27:52.277054 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:27:52.277071 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:27:52.623403 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:27:52.629894 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:27:52.630069 tttmplts.go:39: CGL Worker done
2023/09/16 15:27:52.630105 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:27:57.276072 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:27:57.276374 tttmplts.go:32: PIXm Worker done
2023/09/16 15:27:57.276433 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:27:57.276592 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:27:57.276760 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[602d23a8-2005-4319-95c5-c6e2e3fd7199]]
2023/09/16 15:27:57.520860 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:27:57.963705 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:27:57.969360 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:27:58.074404 ttproxy.go:149: Response Status Code 200
2023/09/16 15:30:30.370233 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:30:32.865879 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:30:32.866391 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:30:32.866527 ttdb.go:54: Opened Database
2023/09/16 15:30:33.076655 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:30:33.141006 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:30:33.141056 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:30:33.205079 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:30:33.299827 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:30:33.299862 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:30:33.363832 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:30:33.429270 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:30:33.429336 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:30:33.492975 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:30:33.590099 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:30:33.590149 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:30:33.688361 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:30:33.850200 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:30:33.851081 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:30:33.926482 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:30:34.153950 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:30:34.154140 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:30:34.258056 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:30:34.404538 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:30:34.404574 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:30:34.467813 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:30:34.622542 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:30:34.622726 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:30:34.710554 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:30:34.841967 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:30:34.842091 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:30:34.920370 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:30:34.990992 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:30:34.991110 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:30:35.056476 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:30:35.134594 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:30:35.134744 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:30:35.198784 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:30:35.281167 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:30:35.281310 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:30:35.348015 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:30:35.415696 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:30:35.415781 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:30:35.485676 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:30:35.549940 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:30:35.550118 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:30:35.615131 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:30:35.679376 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:30:35.679476 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:30:35.742306 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:30:35.805851 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:30:35.805974 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:30:35.869143 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:30:35.935311 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:30:35.935442 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:30:35.998270 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:30:36.066744 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:30:36.066882 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:30:36.130566 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:30:36.196877 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:30:36.197005 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:30:36.261804 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:30:36.330167 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:30:36.330317 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:30:36.398810 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:30:36.465305 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:30:36.465377 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:30:36.529324 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:30:36.593022 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:30:36.593156 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:30:36.593372 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:30:39.618114 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:30:39.618286 ttproxy.go:138: 	Request Query Params
2023/09/16 15:30:39.618662 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:30:39.618694 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:30:39.618742 tttmplts.go:37: CGL Worker starting
2023/09/16 15:30:39.618744 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:30:39.619233 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:30:39.620435 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:30:39.620505 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:30:39.885577 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:30:39.891482 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:30:39.891591 tttmplts.go:39: CGL Worker done
2023/09/16 15:30:39.891626 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:30:44.621057 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:30:44.621560 tttmplts.go:32: PIXm Worker done
2023/09/16 15:30:44.621642 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:30:44.621840 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:30:44.621949 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[259942e3-dfd2-4164-b629-c85f341dde3d]]
2023/09/16 15:30:44.863906 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:30:45.054861 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:30:45.066249 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:30:45.137298 tttmplts.go:93: template: pdsretrieve_tmplt:191:46: executing "pdsretrieve_tmplt" at <.ValueString>: can't evaluate field ValueString in type struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" }
2023/09/16 15:30:45.137554 ttproxy.go:105: template: pdsretrieve_tmplt:191:46: executing "pdsretrieve_tmplt" at <.ValueString>: can't evaluate field ValueString in type struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" }
2023/09/16 15:30:45.137599 ttproxy.go:149: Response Status Code 500
2023/09/16 15:30:45.137612 ttproxy.go:151: 
2023/09/16 15:30:45.137622 ttproxy.go:152: Response Headers
2023/09/16 15:30:45.137746 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:30:45.137778 ttproxy.go:154: ----------------
2023/09/16 15:30:45.137790 ttproxy.go:155: Response
2023/09/16 15:30:45.137800 ttproxy.go:156: ----------------
2023/09/16 15:30:45.138103 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52448",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:30:45.138173 ttproxy.go:158: -------------
2023/09/16 15:30:45.138184 ttproxy.go:160: Error template: pdsretrieve_tmplt:191:46: executing "pdsretrieve_tmplt" at <.ValueString>: can't evaluate field ValueString in type struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" }
2023/09/16 15:30:45.138191 ttproxy.go:161: -------------
2023/09/16 15:31:38.084454 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:31:39.486408 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:31:39.486954 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:31:39.487092 ttdb.go:54: Opened Database
2023/09/16 15:31:39.673742 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:31:39.742183 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:31:39.742365 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:31:39.807394 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:31:39.905825 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:31:39.905874 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:31:39.977655 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:31:40.044360 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:31:40.044507 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:31:40.109385 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:31:40.177838 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:31:40.177893 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:31:40.249145 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:31:40.314003 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:31:40.314064 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:31:40.380062 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:31:40.501762 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:31:40.501843 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:31:40.567149 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:31:40.633001 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:31:40.633096 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:31:40.698336 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:31:40.763041 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:31:40.763123 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:31:40.827937 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:31:40.896282 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:31:40.896423 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:31:40.962650 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:31:41.028152 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:31:41.028296 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:31:41.094352 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:31:41.172020 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:31:41.172151 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:31:41.237169 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:31:41.319162 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:31:41.319287 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:31:41.385494 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:31:41.456958 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:31:41.457075 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:31:41.523203 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:31:41.588678 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:31:41.588775 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:31:41.655203 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:31:41.721914 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:31:41.722123 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:31:41.790290 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:31:41.857315 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:31:41.857506 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:31:41.979179 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:31:42.053301 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:31:42.053477 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:31:42.226372 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:31:42.349970 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:31:42.350141 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:31:42.471811 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:31:42.588406 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:31:42.588601 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:31:42.708707 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:31:42.838418 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:31:42.838555 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:31:42.964493 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:31:43.098666 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:31:43.098818 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:31:43.274569 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:31:43.346016 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:31:43.346173 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:31:43.346506 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:31:46.889715 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:31:46.889893 ttproxy.go:138: 	Request Query Params
2023/09/16 15:31:46.890262 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:31:46.890308 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:31:46.890361 tttmplts.go:37: CGL Worker starting
2023/09/16 15:31:46.890366 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:31:46.890869 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:31:46.892117 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:31:46.892138 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:31:47.081585 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:31:47.087689 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:31:47.087791 tttmplts.go:39: CGL Worker done
2023/09/16 15:31:47.087822 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:31:51.891904 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:31:51.892225 tttmplts.go:32: PIXm Worker done
2023/09/16 15:31:51.892280 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:31:51.892545 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:31:51.892688 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[c6f258db-4738-425d-b44d-6473ce33ce63]]
2023/09/16 15:31:52.086571 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:31:52.286210 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:31:52.292095 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:31:52.361993 tttmplts.go:93: template: pdsretrieve_tmplt:191:46: executing "pdsretrieve_tmplt" at <.valueString>: can't evaluate field valueString in type struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" }
2023/09/16 15:31:52.362220 ttproxy.go:105: template: pdsretrieve_tmplt:191:46: executing "pdsretrieve_tmplt" at <.valueString>: can't evaluate field valueString in type struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" }
2023/09/16 15:31:52.362281 ttproxy.go:149: Response Status Code 500
2023/09/16 15:31:52.362300 ttproxy.go:151: 
2023/09/16 15:31:52.362315 ttproxy.go:152: Response Headers
2023/09/16 15:31:52.362445 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:31:52.362477 ttproxy.go:154: ----------------
2023/09/16 15:31:52.362489 ttproxy.go:155: Response
2023/09/16 15:31:52.362500 ttproxy.go:156: ----------------
2023/09/16 15:31:52.362868 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52476",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:31:52.362897 ttproxy.go:158: -------------
2023/09/16 15:31:52.362908 ttproxy.go:160: Error template: pdsretrieve_tmplt:191:46: executing "pdsretrieve_tmplt" at <.valueString>: can't evaluate field valueString in type struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" }
2023/09/16 15:31:52.362917 ttproxy.go:161: -------------
2023/09/16 15:39:26.236430 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:39:28.379256 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:39:28.379759 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:39:28.379891 ttdb.go:54: Opened Database
2023/09/16 15:39:28.578601 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:39:28.641680 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:39:28.641734 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:39:28.706029 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:39:28.803522 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:39:28.803577 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:39:28.868885 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:39:28.935617 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:39:28.935726 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:39:29.030772 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:39:29.096489 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:39:29.096625 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:39:29.160435 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:39:29.225099 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:39:29.225245 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:39:29.288607 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:39:29.406753 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:39:29.406946 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:39:29.472222 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:39:29.536911 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:39:29.537060 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:39:29.601614 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:39:29.666117 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:39:29.666280 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:39:29.731676 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:39:29.862117 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:39:29.862163 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:39:30.000801 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:39:30.190742 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:39:30.190917 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:39:30.255283 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:39:30.361634 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:39:30.361779 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:39:30.464801 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:39:30.641495 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:39:30.641577 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:39:30.712723 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:39:30.906477 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:39:30.906611 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:39:31.098817 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:39:31.169924 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:39:31.170050 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:39:31.314387 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:39:31.381021 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:39:31.381177 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:39:31.449987 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:39:31.516123 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:39:31.516274 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:39:31.606077 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:39:31.693237 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:39:31.693334 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:39:31.784035 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:39:31.850798 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:39:31.850947 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:39:31.916129 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:39:31.989130 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:39:31.989321 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:39:32.056190 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:39:32.129010 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:39:32.129169 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:39:32.198962 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:39:32.268138 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:39:32.268224 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:39:32.332246 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:39:32.396079 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:39:32.396115 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:39:32.396202 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:39:35.382025 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:39:35.382189 ttproxy.go:138: 	Request Query Params
2023/09/16 15:39:35.382554 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:39:35.382587 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:39:35.382632 tttmplts.go:37: CGL Worker starting
2023/09/16 15:39:35.382657 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:39:35.382987 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:39:35.384342 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:39:35.384414 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:39:35.562427 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:39:35.565681 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:39:35.565755 tttmplts.go:39: CGL Worker done
2023/09/16 15:39:35.565780 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:39:40.384314 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:39:40.384825 tttmplts.go:32: PIXm Worker done
2023/09/16 15:39:40.384888 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:39:40.385345 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:39:40.385533 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[92576081-0f06-4a2f-bed7-71ee443d3066]]
2023/09/16 15:39:40.633232 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:39:40.822472 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:39:40.828186 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:39:40.896341 tttmplts.go:93: template: pdsretrieve_tmplt:179:41: executing "pdsretrieve_tmplt" at <.>: undefined variable: $ext
2023/09/16 15:39:40.896576 ttproxy.go:105: template: pdsretrieve_tmplt:179:41: executing "pdsretrieve_tmplt" at <.>: undefined variable: $ext
2023/09/16 15:39:40.896639 ttproxy.go:149: Response Status Code 500
2023/09/16 15:39:40.896659 ttproxy.go:151: 
2023/09/16 15:39:40.896678 ttproxy.go:152: Response Headers
2023/09/16 15:39:40.896788 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:39:40.896812 ttproxy.go:154: ----------------
2023/09/16 15:39:40.896824 ttproxy.go:155: Response
2023/09/16 15:39:40.896835 ttproxy.go:156: ----------------
2023/09/16 15:39:40.897219 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52618",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:39:40.897294 ttproxy.go:158: -------------
2023/09/16 15:39:40.897312 ttproxy.go:160: Error template: pdsretrieve_tmplt:179:41: executing "pdsretrieve_tmplt" at <.>: undefined variable: $ext
2023/09/16 15:39:40.897331 ttproxy.go:161: -------------
2023/09/16 15:41:51.391909 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:41:53.217554 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:41:53.218048 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:41:53.218177 ttdb.go:54: Opened Database
2023/09/16 15:41:53.652538 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:41:53.797900 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:41:53.798159 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:41:53.908557 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:41:54.055186 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:41:54.055246 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:41:54.218061 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:41:54.412051 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:41:54.412235 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:41:54.549763 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:41:54.643555 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:41:54.643752 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:41:54.719404 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:41:54.787904 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:41:54.788129 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:41:54.854787 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:41:54.972490 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:41:54.972669 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:41:55.037252 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:41:55.107349 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:41:55.107407 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:41:55.171113 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:41:55.234024 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:41:55.234068 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:41:55.299152 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:41:55.370147 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:41:55.370306 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:41:55.434667 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:41:55.498587 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:41:55.498717 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:41:55.562857 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:41:55.641198 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:41:55.641350 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:41:55.704639 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:41:55.785978 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:41:55.786121 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:41:55.849190 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:41:55.919599 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:41:55.919751 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:41:55.982926 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:41:56.051272 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:41:56.051431 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:41:56.115523 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:41:56.178972 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:41:56.179115 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:41:56.242995 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:41:56.306602 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:41:56.306751 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:41:56.371839 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:41:56.438246 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:41:56.438390 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:41:56.502425 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:41:56.568411 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:41:56.568545 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:41:56.632710 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:41:56.702056 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:41:56.702224 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:41:56.767213 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:41:56.835584 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:41:56.835748 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:41:56.898899 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:41:56.965890 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:41:56.966044 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:41:57.031858 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:41:57.095078 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:41:57.095172 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:41:57.095348 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:42:02.559999 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:42:02.560165 ttproxy.go:138: 	Request Query Params
2023/09/16 15:42:02.560486 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:42:02.560522 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:42:02.560562 tttmplts.go:37: CGL Worker starting
2023/09/16 15:42:02.560575 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:42:02.561167 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:42:02.562328 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:42:02.562352 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:42:02.751563 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:42:02.758081 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:42:02.758163 tttmplts.go:39: CGL Worker done
2023/09/16 15:42:02.758197 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:42:07.561485 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:42:07.561957 tttmplts.go:32: PIXm Worker done
2023/09/16 15:42:07.562044 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:42:07.562304 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:42:07.562506 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[68a5f43b-6df1-4da3-b587-3016eaaae912]]
2023/09/16 15:42:07.774249 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:42:07.967488 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:42:07.973275 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:42:08.040532 tttmplts.go:93: template: pdsretrieve_tmplt:180:45: executing "pdsretrieve_tmplt" at <.>: undefined variable: $ext
2023/09/16 15:42:08.040788 ttproxy.go:105: template: pdsretrieve_tmplt:180:45: executing "pdsretrieve_tmplt" at <.>: undefined variable: $ext
2023/09/16 15:42:08.040849 ttproxy.go:149: Response Status Code 500
2023/09/16 15:42:08.040869 ttproxy.go:151: 
2023/09/16 15:42:08.040880 ttproxy.go:152: Response Headers
2023/09/16 15:42:08.040992 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:42:08.041012 ttproxy.go:154: ----------------
2023/09/16 15:42:08.041022 ttproxy.go:155: Response
2023/09/16 15:42:08.041031 ttproxy.go:156: ----------------
2023/09/16 15:42:08.041379 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52657",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:42:08.041500 ttproxy.go:158: -------------
2023/09/16 15:42:08.041513 ttproxy.go:160: Error template: pdsretrieve_tmplt:180:45: executing "pdsretrieve_tmplt" at <.>: undefined variable: $ext
2023/09/16 15:42:08.041524 ttproxy.go:161: -------------
2023/09/16 15:42:41.486232 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:42:43.111122 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:42:43.111600 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:42:43.111744 ttdb.go:54: Opened Database
2023/09/16 15:42:43.284163 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:42:43.347996 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:42:43.348059 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:42:43.413902 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:42:43.510994 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:42:43.511025 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:42:43.576853 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:42:43.644906 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:42:43.645056 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:42:43.708438 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:42:43.771526 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:42:43.771703 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:42:43.838264 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:42:43.902530 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:42:43.902697 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:42:43.968538 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:42:44.088324 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:42:44.088493 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:42:44.153198 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:42:44.218338 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:42:44.218549 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:42:44.284104 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:42:44.348603 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:42:44.348765 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:42:44.413729 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:42:44.486056 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:42:44.486099 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:42:44.550088 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:42:44.615731 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:42:44.615751 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:42:44.679017 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:42:44.753667 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:42:44.753722 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:42:44.817280 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:42:44.895041 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:42:44.895185 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:42:44.961203 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:42:45.032934 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:42:45.033073 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:42:45.096249 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:42:45.162561 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:42:45.162644 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:42:45.229365 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:42:45.293967 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:42:45.294151 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:42:45.358710 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:42:45.422967 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:42:45.423112 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:42:45.487249 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:42:45.559804 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:42:45.559958 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:42:45.623853 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:42:45.689188 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:42:45.689286 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:42:45.753846 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:42:45.821844 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:42:45.821970 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:42:45.888804 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:42:45.960435 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:42:45.960530 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:42:46.025643 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:42:46.093782 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:42:46.093910 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:42:46.157597 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:42:46.223706 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:42:46.223808 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:42:46.224125 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:42:49.851510 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:42:49.851692 ttproxy.go:138: 	Request Query Params
2023/09/16 15:42:49.852050 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:42:49.852098 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:42:49.852163 tttmplts.go:37: CGL Worker starting
2023/09/16 15:42:49.852162 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:42:49.852643 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:42:49.853879 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:42:49.853951 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:42:50.141679 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:42:50.147738 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:42:50.147892 tttmplts.go:39: CGL Worker done
2023/09/16 15:42:50.147939 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:42:54.862059 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:42:54.862405 tttmplts.go:32: PIXm Worker done
2023/09/16 15:42:54.862467 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:42:54.862615 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:42:54.862782 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[91042ed7-137c-4a6b-be9d-79f2a9f032ac]]
2023/09/16 15:42:55.008887 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:42:55.198758 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:42:55.208178 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:42:55.276958 tttmplts.go:93: template: pdsretrieve_tmplt:192:54: executing "pdsretrieve_tmplt" at <$ext.ValueString>: can't evaluate field ValueString in type struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" }
2023/09/16 15:42:55.277218 ttproxy.go:105: template: pdsretrieve_tmplt:192:54: executing "pdsretrieve_tmplt" at <$ext.ValueString>: can't evaluate field ValueString in type struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" }
2023/09/16 15:42:55.277272 ttproxy.go:149: Response Status Code 500
2023/09/16 15:42:55.277288 ttproxy.go:151: 
2023/09/16 15:42:55.277298 ttproxy.go:152: Response Headers
2023/09/16 15:42:55.277410 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:42:55.277435 ttproxy.go:154: ----------------
2023/09/16 15:42:55.277445 ttproxy.go:155: Response
2023/09/16 15:42:55.277454 ttproxy.go:156: ----------------
2023/09/16 15:42:55.277824 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52679",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:42:55.277850 ttproxy.go:158: -------------
2023/09/16 15:42:55.277861 ttproxy.go:160: Error template: pdsretrieve_tmplt:192:54: executing "pdsretrieve_tmplt" at <$ext.ValueString>: can't evaluate field ValueString in type struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" }
2023/09/16 15:42:55.277870 ttproxy.go:161: -------------
2023/09/16 15:43:59.357426 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:44:04.735876 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:44:04.736244 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:44:04.736364 ttdb.go:54: Opened Database
2023/09/16 15:44:04.910189 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:44:04.975808 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:44:04.976069 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:44:05.040204 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:44:05.138387 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:44:05.138520 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:44:05.200680 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:44:05.265270 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:44:05.265408 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:44:05.389200 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:44:05.533099 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:44:05.533185 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:44:05.692835 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:44:05.810882 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:44:05.811027 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:44:05.957855 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:44:06.130833 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:44:06.130961 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:44:06.193615 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:44:06.307192 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:44:06.307329 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:44:06.445766 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:44:06.600661 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:44:06.600750 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:44:06.781293 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:44:06.915845 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:44:06.916010 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:44:07.080248 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:44:07.228912 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:44:07.229062 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:44:07.291365 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:44:07.471480 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:44:07.471638 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:44:07.550150 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:44:07.629119 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:44:07.629253 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:44:07.692669 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:44:07.761310 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:44:07.761455 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:44:07.822771 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:44:07.886955 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:44:07.887101 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:44:07.951950 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:44:08.013970 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:44:08.014109 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:44:08.075631 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:44:08.141006 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:44:08.141087 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:44:08.207289 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:44:08.279329 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:44:08.279493 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:44:08.341553 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:44:08.410803 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:44:08.410953 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:44:08.474366 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:44:08.541592 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:44:08.541726 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:44:08.603205 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:44:08.670642 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:44:08.670775 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:44:08.731769 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:44:08.801565 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:44:08.801735 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:44:08.863468 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:44:08.926653 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:44:08.926775 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:44:08.927036 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:44:15.802047 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:44:15.802209 ttproxy.go:138: 	Request Query Params
2023/09/16 15:44:15.802534 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:44:15.802565 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:44:15.802611 tttmplts.go:37: CGL Worker starting
2023/09/16 15:44:15.802612 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:44:15.803000 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:44:15.804500 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:44:15.804517 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:44:15.983225 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:44:15.989216 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:44:15.989309 tttmplts.go:39: CGL Worker done
2023/09/16 15:44:15.989342 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:44:20.804266 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:44:20.804688 tttmplts.go:32: PIXm Worker done
2023/09/16 15:44:20.804745 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:44:20.804901 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:44:20.805033 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[3ccf2f89-2bb4-4e79-bed5-141d9261ff0e]]
2023/09/16 15:44:21.038343 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:44:21.489647 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:44:21.494828 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:44:21.561269 tttmplts.go:93: template: pdsretrieve_tmplt:186:54: executing "pdsretrieve_tmplt" at <$ext.ValueString>: can't evaluate field ValueString in type struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" }
2023/09/16 15:44:21.561518 ttproxy.go:105: template: pdsretrieve_tmplt:186:54: executing "pdsretrieve_tmplt" at <$ext.ValueString>: can't evaluate field ValueString in type struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" }
2023/09/16 15:44:21.561583 ttproxy.go:149: Response Status Code 500
2023/09/16 15:44:21.561602 ttproxy.go:151: 
2023/09/16 15:44:21.561612 ttproxy.go:152: Response Headers
2023/09/16 15:44:21.561728 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:44:21.561746 ttproxy.go:154: ----------------
2023/09/16 15:44:21.561762 ttproxy.go:155: Response
2023/09/16 15:44:21.561771 ttproxy.go:156: ----------------
2023/09/16 15:44:21.562069 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52714",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:44:21.562184 ttproxy.go:158: -------------
2023/09/16 15:44:21.562200 ttproxy.go:160: Error template: pdsretrieve_tmplt:186:54: executing "pdsretrieve_tmplt" at <$ext.ValueString>: can't evaluate field ValueString in type struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" }
2023/09/16 15:44:21.562210 ttproxy.go:161: -------------
2023/09/16 15:48:15.618810 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:48:18.293471 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:48:18.293993 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:48:18.294124 ttdb.go:54: Opened Database
2023/09/16 15:48:18.484062 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:48:18.547585 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:48:18.547639 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:48:18.610572 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:48:18.708070 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:48:18.708157 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:48:18.771724 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:48:18.836320 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:48:18.836410 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:48:18.899997 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:48:18.965208 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:48:18.965299 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:48:19.027792 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:48:19.090905 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:48:19.091079 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:48:19.154477 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:48:19.273232 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:48:19.273416 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:48:19.340649 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:48:19.405071 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:48:19.405198 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:48:19.470002 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:48:19.536473 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:48:19.536644 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:48:19.600812 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:48:19.669741 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:48:19.669916 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:48:19.734313 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:48:19.797979 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:48:19.798119 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:48:19.861870 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:48:19.937069 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:48:19.937179 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:48:20.002299 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:48:20.081984 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:48:20.082125 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:48:20.145282 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:48:20.215111 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:48:20.215323 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:48:20.279018 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:48:20.342474 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:48:20.342585 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:48:20.406312 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:48:20.468624 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:48:20.468759 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:48:20.533390 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:48:20.596759 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:48:20.596909 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:48:20.659417 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:48:20.725499 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:48:20.725613 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:48:20.787757 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:48:20.854982 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:48:20.855077 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:48:20.917854 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:48:20.989321 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:48:20.989418 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:48:21.052847 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:48:21.122167 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:48:21.122304 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:48:21.185790 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:48:21.252121 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:48:21.252241 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:48:21.315685 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:48:21.380887 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:48:21.381038 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:48:21.381296 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:48:26.246177 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:48:26.246380 ttproxy.go:138: 	Request Query Params
2023/09/16 15:48:26.246717 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:48:26.246757 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:48:26.246796 tttmplts.go:37: CGL Worker starting
2023/09/16 15:48:26.246796 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:48:26.247276 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:48:26.248480 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:48:26.248553 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:48:26.624542 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:48:26.629876 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:48:26.629994 tttmplts.go:39: CGL Worker done
2023/09/16 15:48:26.630025 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:48:31.248575 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:48:31.248906 tttmplts.go:32: PIXm Worker done
2023/09/16 15:48:31.248968 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:48:31.249153 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:48:31.249278 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[d014be7b-1e1c-4cd0-b47a-568ddf048ea0]]
2023/09/16 15:48:31.413207 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:48:31.601531 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:48:31.607247 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:48:31.675227 tttmplts.go:93: template: pdsretrieve_tmplt:178:36: executing "pdsretrieve_tmplt" at <.Array>: can't evaluate field Array in type struct { URL string "json:\"url,omitempty\""; ValueReference struct { Identifier struct { System string "json:\"system,omitempty\""; Value string "json:\"value,omitempty\"" } "json:\"identifier,omitempty\"" } "json:\"valueReference,omitempty\""; Extension []struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" } "json:\"extension,omitempty\""; ValueAddress struct { City string "json:\"city,omitempty\""; District string "json:\"district,omitempty\""; Country string "json:\"country,omitempty\"" } "json:\"valueAddress,omitempty\"" }
2023/09/16 15:48:31.675519 ttproxy.go:105: template: pdsretrieve_tmplt:178:36: executing "pdsretrieve_tmplt" at <.Array>: can't evaluate field Array in type struct { URL string "json:\"url,omitempty\""; ValueReference struct { Identifier struct { System string "json:\"system,omitempty\""; Value string "json:\"value,omitempty\"" } "json:\"identifier,omitempty\"" } "json:\"valueReference,omitempty\""; Extension []struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" } "json:\"extension,omitempty\""; ValueAddress struct { City string "json:\"city,omitempty\""; District string "json:\"district,omitempty\""; Country string "json:\"country,omitempty\"" } "json:\"valueAddress,omitempty\"" }
2023/09/16 15:48:31.675573 ttproxy.go:149: Response Status Code 500
2023/09/16 15:48:31.675589 ttproxy.go:151: 
2023/09/16 15:48:31.675598 ttproxy.go:152: Response Headers
2023/09/16 15:48:31.675700 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:48:31.675717 ttproxy.go:154: ----------------
2023/09/16 15:48:31.675728 ttproxy.go:155: Response
2023/09/16 15:48:31.675736 ttproxy.go:156: ----------------
2023/09/16 15:48:31.676071 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52785",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:48:31.676105 ttproxy.go:158: -------------
2023/09/16 15:48:31.676115 ttproxy.go:160: Error template: pdsretrieve_tmplt:178:36: executing "pdsretrieve_tmplt" at <.Array>: can't evaluate field Array in type struct { URL string "json:\"url,omitempty\""; ValueReference struct { Identifier struct { System string "json:\"system,omitempty\""; Value string "json:\"value,omitempty\"" } "json:\"identifier,omitempty\"" } "json:\"valueReference,omitempty\""; Extension []struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" } "json:\"extension,omitempty\""; ValueAddress struct { City string "json:\"city,omitempty\""; District string "json:\"district,omitempty\""; Country string "json:\"country,omitempty\"" } "json:\"valueAddress,omitempty\"" }
2023/09/16 15:48:31.676122 ttproxy.go:161: -------------
2023/09/16 15:53:41.797369 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:53:43.538255 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:53:43.538738 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:53:43.538860 ttdb.go:54: Opened Database
2023/09/16 15:53:43.731528 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:53:43.793910 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:53:43.793955 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:53:43.857464 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:53:43.955507 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:53:43.955688 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:53:44.019642 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:53:44.083849 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:53:44.083995 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:53:44.146699 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:53:44.210227 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:53:44.210398 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:53:44.273464 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:53:44.336829 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:53:44.336968 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:53:44.401072 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:53:44.520963 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:53:44.521160 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:53:44.585822 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:53:44.650351 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:53:44.650562 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:53:44.715718 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:53:44.780122 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:53:44.780266 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:53:44.844244 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:53:44.913180 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:53:44.913341 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:53:44.990388 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:53:45.055490 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:53:45.055646 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:53:45.119216 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:53:45.194572 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:53:45.194614 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:53:45.260318 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:53:45.341111 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:53:45.341267 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:53:45.404504 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:53:45.474636 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:53:45.474760 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:53:45.539062 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:53:45.606507 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:53:45.606710 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:53:45.672535 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:53:45.737946 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:53:45.738144 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:53:45.803144 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:53:45.865683 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:53:45.865825 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:53:45.996449 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:53:46.167607 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:53:46.167758 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:53:46.234434 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:53:46.401130 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:53:46.401178 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:53:46.525427 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:53:46.713446 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:53:46.713632 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:53:46.786124 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:53:46.923130 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:53:46.923236 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:53:47.080494 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:53:47.241027 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:53:47.241202 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:53:47.409411 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:53:47.544534 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:53:47.544678 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:53:47.544941 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:53:50.497231 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:53:50.497380 ttproxy.go:138: 	Request Query Params
2023/09/16 15:53:50.497707 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:53:50.497738 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:53:50.497780 tttmplts.go:37: CGL Worker starting
2023/09/16 15:53:50.497777 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:53:50.498250 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:53:50.499625 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:53:50.499753 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:53:50.699908 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:53:50.703029 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:53:50.703104 tttmplts.go:39: CGL Worker done
2023/09/16 15:53:50.703121 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:53:55.499598 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:53:55.500041 tttmplts.go:32: PIXm Worker done
2023/09/16 15:53:55.500106 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:53:55.500277 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:53:55.500459 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[9499c2b1-3255-47d3-87aa-6cd493e34883]]
2023/09/16 15:53:55.987835 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:53:56.381584 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:53:56.389315 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:53:56.393296 tttmplts.go:93: template: pdsretrieve_tmplt:172:30: executing "pdsretrieve_tmplt" at <index . "extension">: error calling index: can't index item of type struct { URL string "json:\"url,omitempty\""; ValueReference struct { Identifier struct { System string "json:\"system,omitempty\""; Value string "json:\"value,omitempty\"" } "json:\"identifier,omitempty\"" } "json:\"valueReference,omitempty\""; Extension []struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" } "json:\"extension,omitempty\""; ValueAddress struct { City string "json:\"city,omitempty\""; District string "json:\"district,omitempty\""; Country string "json:\"country,omitempty\"" } "json:\"valueAddress,omitempty\"" }
2023/09/16 15:53:56.393444 ttproxy.go:105: template: pdsretrieve_tmplt:172:30: executing "pdsretrieve_tmplt" at <index . "extension">: error calling index: can't index item of type struct { URL string "json:\"url,omitempty\""; ValueReference struct { Identifier struct { System string "json:\"system,omitempty\""; Value string "json:\"value,omitempty\"" } "json:\"identifier,omitempty\"" } "json:\"valueReference,omitempty\""; Extension []struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" } "json:\"extension,omitempty\""; ValueAddress struct { City string "json:\"city,omitempty\""; District string "json:\"district,omitempty\""; Country string "json:\"country,omitempty\"" } "json:\"valueAddress,omitempty\"" }
2023/09/16 15:53:56.393479 ttproxy.go:149: Response Status Code 500
2023/09/16 15:53:56.393492 ttproxy.go:151: 
2023/09/16 15:53:56.393503 ttproxy.go:152: Response Headers
2023/09/16 15:53:56.393599 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:53:56.393617 ttproxy.go:154: ----------------
2023/09/16 15:53:56.393628 ttproxy.go:155: Response
2023/09/16 15:53:56.393639 ttproxy.go:156: ----------------
2023/09/16 15:53:56.393943 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52881",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:53:56.393987 ttproxy.go:158: -------------
2023/09/16 15:53:56.394000 ttproxy.go:160: Error template: pdsretrieve_tmplt:172:30: executing "pdsretrieve_tmplt" at <index . "extension">: error calling index: can't index item of type struct { URL string "json:\"url,omitempty\""; ValueReference struct { Identifier struct { System string "json:\"system,omitempty\""; Value string "json:\"value,omitempty\"" } "json:\"identifier,omitempty\"" } "json:\"valueReference,omitempty\""; Extension []struct { URL string "json:\"url,omitempty\""; ValueCodeableConcept struct { Coding []struct { System string "json:\"system,omitempty\""; Version string "json:\"version,omitempty\""; Code string "json:\"code,omitempty\""; Display string "json:\"display,omitempty\"" } "json:\"coding,omitempty\"" } "json:\"valueCodeableConcept,omitempty\""; ValueDateTime time.Time "json:\"valueDateTime,omitempty\"" } "json:\"extension,omitempty\""; ValueAddress struct { City string "json:\"city,omitempty\""; District string "json:\"district,omitempty\""; Country string "json:\"country,omitempty\"" } "json:\"valueAddress,omitempty\"" }
2023/09/16 15:53:56.394011 ttproxy.go:161: -------------
2023/09/16 15:55:46.884989 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:55:48.424278 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:55:48.424780 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:55:48.424908 ttdb.go:54: Opened Database
2023/09/16 15:55:48.608718 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:55:48.673418 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:55:48.673520 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:55:48.737028 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:55:48.833057 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:55:48.833096 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:55:48.899865 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:55:48.964698 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:55:48.964807 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:55:49.029301 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:55:49.097431 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:55:49.097509 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:55:49.159870 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:55:49.223783 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:55:49.223924 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:55:49.286513 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:55:49.403505 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:55:49.403651 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:55:49.467227 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:55:49.535396 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:55:49.535498 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:55:49.598691 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:55:49.661914 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:55:49.661973 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:55:49.725050 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:55:49.791214 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:55:49.791236 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:55:49.854961 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:55:49.919282 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:55:49.919306 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:55:49.984467 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:55:50.061409 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:55:50.061446 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:55:50.128184 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:55:50.210778 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:55:50.210882 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:55:50.280397 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:55:50.350688 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:55:50.350774 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:55:50.414479 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:55:50.477779 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:55:50.477836 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:55:50.544226 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:55:50.608871 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:55:50.609077 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:55:50.671678 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:55:50.735462 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:55:50.735603 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:55:50.799317 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:55:50.868439 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:55:50.868588 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:55:50.934759 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:55:51.000741 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:55:51.000917 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:55:51.065437 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:55:51.135032 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:55:51.135189 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:55:51.200770 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:55:51.273237 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:55:51.273402 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:55:51.338787 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:55:51.408172 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:55:51.408440 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:55:51.475357 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:55:51.537740 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:55:51.537796 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:55:51.537914 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:55:53.870657 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:55:53.870819 ttproxy.go:138: 	Request Query Params
2023/09/16 15:55:53.871171 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:55:53.871213 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:55:53.871255 tttmplts.go:37: CGL Worker starting
2023/09/16 15:55:53.871254 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:55:53.871728 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:55:53.873151 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:55:53.873175 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:55:54.066787 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:55:54.073173 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:55:54.073295 tttmplts.go:39: CGL Worker done
2023/09/16 15:55:54.073328 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:55:58.873062 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:55:58.873475 tttmplts.go:32: PIXm Worker done
2023/09/16 15:55:58.873542 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:55:58.873732 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:55:58.873874 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[7a912975-755b-4b12-b211-d20f4df4be41]]
2023/09/16 15:55:59.124879 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:55:59.590792 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:55:59.597069 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:55:59.602624 tttmplts.go:93: template: pdsretrieve_tmplt:172:30: executing "pdsretrieve_tmplt" at <index $rsp.Extension "extension">: error calling index: cannot index slice/array with type string
2023/09/16 15:55:59.602867 ttproxy.go:105: template: pdsretrieve_tmplt:172:30: executing "pdsretrieve_tmplt" at <index $rsp.Extension "extension">: error calling index: cannot index slice/array with type string
2023/09/16 15:55:59.602919 ttproxy.go:149: Response Status Code 500
2023/09/16 15:55:59.602938 ttproxy.go:151: 
2023/09/16 15:55:59.602948 ttproxy.go:152: Response Headers
2023/09/16 15:55:59.603059 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:55:59.603082 ttproxy.go:154: ----------------
2023/09/16 15:55:59.603101 ttproxy.go:155: Response
2023/09/16 15:55:59.603111 ttproxy.go:156: ----------------
2023/09/16 15:55:59.603420 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52909",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:55:59.603457 ttproxy.go:158: -------------
2023/09/16 15:55:59.603480 ttproxy.go:160: Error template: pdsretrieve_tmplt:172:30: executing "pdsretrieve_tmplt" at <index $rsp.Extension "extension">: error calling index: cannot index slice/array with type string
2023/09/16 15:55:59.603490 ttproxy.go:161: -------------
2023/09/16 15:58:40.542820 ttserver.go:52: ICB Workflow Service stopped
2023/09/16 15:58:42.208949 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/16 15:58:42.209467 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/16 15:58:42.209601 ttdb.go:54: Opened Database
2023/09/16 15:58:42.388930 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/16 15:58:42.454337 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/16 15:58:42.454379 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/16 15:58:42.517289 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/16 15:58:42.615201 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/16 15:58:42.615359 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/16 15:58:42.677474 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/16 15:58:42.752031 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/16 15:58:42.752155 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/16 15:58:42.888575 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/16 15:58:43.017960 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/16 15:58:43.018126 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/16 15:58:43.123424 ttdb.go:379: Persisting Template notification_tmplt
2023/09/16 15:58:43.243845 ttdb.go:385: Persisted Template notification_tmplt
2023/09/16 15:58:43.244017 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/16 15:58:43.363282 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/16 15:58:43.484401 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/16 15:58:43.484592 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/16 15:58:43.549635 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/16 15:58:43.614599 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/16 15:58:43.614825 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/16 15:58:43.679876 ttdb.go:379: Persisting Template react_tmplt
2023/09/16 15:58:43.745157 ttdb.go:385: Persisted Template react_tmplt
2023/09/16 15:58:43.745372 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/16 15:58:43.810900 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/16 15:58:43.877418 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/16 15:58:43.877456 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/16 15:58:43.941124 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/16 15:58:44.004151 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/16 15:58:44.004196 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/16 15:58:44.073297 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/16 15:58:44.149173 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/16 15:58:44.149226 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/16 15:58:44.216366 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/16 15:58:44.297301 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/16 15:58:44.297464 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/16 15:58:44.363222 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/16 15:58:44.433966 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/16 15:58:44.434172 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/16 15:58:44.499256 ttdb.go:379: Persisting Template pds_tmplt
2023/09/16 15:58:44.586985 ttdb.go:385: Persisted Template pds_tmplt
2023/09/16 15:58:44.587143 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/16 15:58:44.649515 ttdb.go:379: Persisting Template error_tmplt
2023/09/16 15:58:44.715010 ttdb.go:385: Persisted Template error_tmplt
2023/09/16 15:58:44.715149 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/16 15:58:44.778263 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/16 15:58:44.864058 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/16 15:58:44.864223 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/16 15:58:45.031828 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/16 15:58:45.143108 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/16 15:58:45.143350 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/16 15:58:45.318251 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/16 15:58:45.449860 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/16 15:58:45.450013 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/16 15:58:45.573116 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/16 15:58:45.719773 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/16 15:58:45.719921 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/16 15:58:45.784139 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/16 15:58:45.854859 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/16 15:58:45.855009 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/16 15:58:45.918266 ttdb.go:379: Persisting Template events_tmplt
2023/09/16 15:58:45.996782 ttdb.go:385: Persisted Template events_tmplt
2023/09/16 15:58:45.996937 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/16 15:58:46.060629 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/16 15:58:46.127489 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/16 15:58:46.127642 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/16 15:58:46.127917 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/16 15:58:48.891207 ttgethandler.go:10: Processing new GET Request
2023/09/16 15:58:48.891364 ttproxy.go:138: 	Request Query Params
2023/09/16 15:58:48.891687 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "tiani-spirit",
  "Role": "clinical",
  "Nhs": "9000000009"
}
2023/09/16 15:58:48.891754 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/16 15:58:48.891802 tttmplts.go:37: CGL Worker starting
2023/09/16 15:58:48.891803 tttmplts.go:30: PIXm Worker starting
2023/09/16 15:58:48.892305 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C9000000009
2023/09/16 15:58:48.893621 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/16 15:58:48.893640 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/16 15:58:49.074031 tthttp.go:174: Server Response - Status Code 404 
{"errors":[{"message":"No clients matching nhs number 9000000009","path":"\/"}],"status":404}
2023/09/16 15:58:49.077242 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {},
        "name": {}
      },
      "bbvInformation": {},
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "mentalHealthDomain": {},
        "riskOfHarmToSelfDomain": {},
        "socialDomain": {},
        "substanceMisuseDomain": {}
      },
      "safeguardingInformation": {}
    },
    "keyWorker": {
      "name": {}
    }
  }
}
2023/09/16 15:58:49.077351 tttmplts.go:39: CGL Worker done
2023/09/16 15:58:49.077373 tttmplts.go:40: CGL Worker Status Code 404
2023/09/16 15:58:53.894003 tthttp.go:174: Server Response - Status Code 0 
2023/09/16 15:58:53.894298 tttmplts.go:32: PIXm Worker done
2023/09/16 15:58:53.894354 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/16 15:58:53.894638 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient/9000000009
2023/09/16 15:58:53.894770 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[36773e6f-4979-4c25-97d2-3d804d3d57a4]]
2023/09/16 15:58:54.119591 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Patient","id":"9000000009","identifier":[{"system":"https://fhir.nhs.uk/Id/nhs-number","value":"9000000009","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus","version":"1.0.0","code":"01","display":"Number present and verified"}]}}]}],"meta":{"versionId":"2","security":[{"system":"http://terminology.hl7.org/CodeSystem/v3-Confidentiality","code":"U","display":"unrestricted"}]},"name":[{"id":"123","use":"usual","period":{"start":"2020-01-01","end":"2021-12-31"},"given":["Jane"],"family":"Smith","prefix":["Mrs"],"suffix":["MBE"]}],"gender":"female","birthDate":"2010-10-22","multipleBirthInteger":1,"deceasedDateTime":"2010-10-22T00:00:00+00:00","generalPractitioner":[{"id":"254406A3","type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}}],"managingOrganization":{"type":"Organization","identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345","period":{"start":"2020-01-01","end":"2021-12-31"}}},"extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y12345"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y23456"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier","valueReference":{"identifier":{"system":"https://fhir.nhs.uk/Id/ods-organization-code","value":"Y34567"}}},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus","extension":[{"url":"deathNotificationStatus","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus","version":"1.0.0","code":"2","display":"Formal - death notice received from Registrar of Deaths"}]}},{"url":"systemEffectiveDate","valueDateTime":"2010-10-22T00:00:00+00:00"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication","extension":[{"url":"language","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage","version":"1.0.0","code":"fr","display":"French"}]}},{"url":"interpreterRequired","valueBoolean":true}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference","extension":[{"url":"PreferredWrittenCommunicationFormat","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat","code":"12","display":"Braille"}]}},{"url":"PreferredContactMethod","valueCodeableConcept":{"coding":[{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod","code":"1","display":"Letter"}]}},{"url":"PreferredContactTimes","valueString":"Not after 7pm"}]},{"url":"http://hl7.org/fhir/StructureDefinition/patient-birthPlace","valueAddress":{"city":"Manchester","district":"Greater Manchester","country":"GBR"}},{"url":"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration","extension":[{"url":"removalFromRegistrationCode","valueCodeableConcept":{"coding":[{"system":"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode","code":"SCT","display":"Transferred to Scotland"}]}},{"url":"effectiveTime","valuePeriod":{"start":"2020-01-01T00:00:00+00:00","end":"2021-12-31T00:00:00+00:00"}}]}],"telecom":[{"id":"789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"phone","value":"01632960587","use":"home"},{"id":"790","period":{"start":"2019-01-01","end":"2022-12-31"},"system":"email","value":"jane.smith@example.com","use":"home"},{"id":"OC789","period":{"start":"2020-01-01","end":"2021-12-31"},"system":"other","value":"01632960587","use":"home","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem","code":"textphone","display":"Minicom (Textphone)"}}]}],"contact":[{"id":"C123","period":{"start":"2020-01-01","end":"2021-12-31"},"relationship":[{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/v2-0131","code":"C","display":"Emergency Contact"}]}],"telecom":[{"system":"phone","value":"01632960587"}]}],"address":[{"id":"456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"home","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]},{"id":"T456","period":{"start":"2020-01-01","end":"2021-12-31"},"use":"temp","text":"Student Accommodation","line":["1 Trevelyan Square","Boar Lane","City Centre","Leeds","West Yorkshire"],"postalCode":"LS1 6AE","extension":[{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"PAF"}},{"url":"value","valueString":"12345678"}]},{"url":"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey","extension":[{"url":"type","valueCoding":{"system":"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType","code":"UPRN"}},{"url":"value","valueString":"123456789012"}]}]}]}
2023/09/16 15:58:54.309592 tttmplts.go:100: Caching 24 Templates
2023/09/16 15:58:54.315290 tttmplts.go:87: Processing Template allpatientSrvs_tmplt
2023/09/16 15:58:54.319205 tttmplts.go:93: template: pdsretrieve_tmplt:172:30: executing "pdsretrieve_tmplt" at <index .Extension "extension">: error calling index: cannot index slice/array with type string
2023/09/16 15:58:54.319424 ttproxy.go:105: template: pdsretrieve_tmplt:172:30: executing "pdsretrieve_tmplt" at <index .Extension "extension">: error calling index: cannot index slice/array with type string
2023/09/16 15:58:54.319484 ttproxy.go:149: Response Status Code 500
2023/09/16 15:58:54.319498 ttproxy.go:151: 
2023/09/16 15:58:54.319507 ttproxy.go:152: Response Headers
2023/09/16 15:58:54.319604 ttutil.go:140: 	{
  "Access-Control-Allow-Origin": "*",
  "Content-Type": "",
  "Server": "Workflow Service"
}
2023/09/16 15:58:54.319622 ttproxy.go:154: ----------------
2023/09/16 15:58:54.319630 ttproxy.go:155: Response
2023/09/16 15:58:54.319636 ttproxy.go:156: ----------------
2023/09/16 15:58:54.319970 ttutil.go:140: 	{
  "Host": "MacBook-Pro-3.lan",
  "Path": "/beta/spa/consumer/patient",
  "Method": "GET",
  "SourceIP": "[::1]:52953",
  "ReqContentType": "",
  "RspContentType": "",
  "ResponseBody": "{\"resourceType\":\"Patient\",\"id\":\"9000000009\",\"identifier\":[{\"system\":\"https://fhir.nhs.uk/Id/nhs-number\",\"value\":\"9000000009\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\",\"version\":\"1.0.0\",\"code\":\"01\",\"display\":\"Number present and verified\"}]}}]}],\"meta\":{\"versionId\":\"2\",\"security\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-Confidentiality\",\"code\":\"U\",\"display\":\"unrestricted\"}]},\"name\":[{\"id\":\"123\",\"use\":\"usual\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"given\":[\"Jane\"],\"family\":\"Smith\",\"prefix\":[\"Mrs\"],\"suffix\":[\"MBE\"]}],\"gender\":\"female\",\"birthDate\":\"2010-10-22\",\"multipleBirthInteger\":1,\"deceasedDateTime\":\"2010-10-22T00:00:00+00:00\",\"generalPractitioner\":[{\"id\":\"254406A3\",\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}}],\"managingOrganization\":{\"type\":\"Organization\",\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"}}},\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y12345\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-PreferredDispenserOrganization\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y23456\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\",\"valueReference\":{\"identifier\":{\"system\":\"https://fhir.nhs.uk/Id/ods-organization-code\",\"value\":\"Y34567\"}}},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\",\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\",\"code\":\"2\",\"display\":\"Formal - death notice received from Registrar of Deaths\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"2010-10-22T00:00:00+00:00\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication\",\"extension\":[{\"url\":\"language\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\",\"version\":\"1.0.0\",\"code\":\"fr\",\"display\":\"French\"}]}},{\"url\":\"interpreterRequired\",\"valueBoolean\":true}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\",\"extension\":[{\"url\":\"PreferredWrittenCommunicationFormat\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\",\"code\":\"12\",\"display\":\"Braille\"}]}},{\"url\":\"PreferredContactMethod\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredContactMethod\",\"code\":\"1\",\"display\":\"Letter\"}]}},{\"url\":\"PreferredContactTimes\",\"valueString\":\"Not after 7pm\"}]},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\",\"valueAddress\":{\"city\":\"Manchester\",\"district\":\"Greater Manchester\",\"country\":\"GBR\"}},{\"url\":\"https://fhir.nhs.uk/StructureDefinition/Extension-PDS-RemovalFromRegistration\",\"extension\":[{\"url\":\"removalFromRegistrationCode\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nhs.uk/CodeSystem/PDS-RemovalReasonExitCode\",\"code\":\"SCT\",\"display\":\"Transferred to Scotland\"}]}},{\"url\":\"effectiveTime\",\"valuePeriod\":{\"start\":\"2020-01-01T00:00:00+00:00\",\"end\":\"2021-12-31T00:00:00+00:00\"}}]}],\"telecom\":[{\"id\":\"789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"phone\",\"value\":\"01632960587\",\"use\":\"home\"},{\"id\":\"790\",\"period\":{\"start\":\"2019-01-01\",\"end\":\"2022-12-31\"},\"system\":\"email\",\"value\":\"jane.smith@example.com\",\"use\":\"home\"},{\"id\":\"OC789\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"system\":\"other\",\"value\":\"01632960587\",\"use\":\"home\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-OtherContactSystem\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-OtherContactSystem\",\"code\":\"textphone\",\"display\":\"Minicom (Textphone)\"}}]}],\"contact\":[{\"id\":\"C123\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"relationship\":[{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0131\",\"code\":\"C\",\"display\":\"Emergency Contact\"}]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"01632960587\"}]}],\"address\":[{\"id\":\"456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"home\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]},{\"id\":\"T456\",\"period\":{\"start\":\"2020-01-01\",\"end\":\"2021-12-31\"},\"use\":\"temp\",\"text\":\"Student Accommodation\",\"line\":[\"1 Trevelyan Square\",\"Boar Lane\",\"City Centre\",\"Leeds\",\"West Yorkshire\"],\"postalCode\":\"LS1 6AE\",\"extension\":[{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"PAF\"}},{\"url\":\"value\",\"valueString\":\"12345678\"}]},{\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey\",\"extension\":[{\"url\":\"type\",\"valueCoding\":{\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType\",\"code\":\"UPRN\"}},{\"url\":\"value\",\"valueString\":\"123456789012\"}]}]}]}",
  "StatusCode": 500,
  "IsBase64": false,
  "Timeout": 0
}
2023/09/16 15:58:54.320010 ttproxy.go:158: -------------
2023/09/16 15:58:54.320019 ttproxy.go:160: Error template: pdsretrieve_tmplt:172:30: executing "pdsretrieve_tmplt" at <index .Extension "extension">: error calling index: cannot index slice/array with type string
2023/09/16 15:58:54.320027 ttproxy.go:161: -------------
2023/09/16 16:00:51.789846 ttserver.go:52: ICB Workflow Service stopped
