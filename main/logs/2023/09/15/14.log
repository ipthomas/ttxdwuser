2023/09/15 14:57:13.290445 ttutil.go:133: -----------------------------------------------------------------------------------
2023/09/15 14:57:13.290951 ttdb.go:51: Opening DB Connection to mysql instance
User: root
Host: tuk.coil1nnpqdlr.eu-west-1.rds.amazonaws.com
Port: :3306
Name: tuk
Connect Timeout 2s
Read Timeout 5s
2023/09/15 14:57:13.291083 ttdb.go:54: Opened Database
2023/09/15 14:57:13.545979 ttdb.go:379: Persisting Template dsubcancel_tmplt
2023/09/15 14:57:13.613762 ttdb.go:385: Persisted Template dsubcancel_tmplt
2023/09/15 14:57:13.613837 ttdb.go:366: Persisted Template dsubcancel_tmplt.xml
2023/09/15 14:57:13.680163 ttdb.go:379: Persisting Template cgl_tmplt
2023/09/15 14:57:13.780208 ttdb.go:385: Persisted Template cgl_tmplt
2023/09/15 14:57:13.780420 ttdb.go:366: Persisted Template cgl_tmplt.html
2023/09/15 14:57:13.844714 ttdb.go:379: Persisting Template pdssearch_tmplt
2023/09/15 14:57:13.909520 ttdb.go:385: Persisted Template pdssearch_tmplt
2023/09/15 14:57:13.909579 ttdb.go:366: Persisted Template pdssearch_tmplt.html
2023/09/15 14:57:13.971525 ttdb.go:379: Persisting Template dsubsubscribe_tmplt
2023/09/15 14:57:14.033260 ttdb.go:385: Persisted Template dsubsubscribe_tmplt
2023/09/15 14:57:14.033322 ttdb.go:366: Persisted Template dsubsubscribe_tmplt.xml
2023/09/15 14:57:14.096494 ttdb.go:379: Persisting Template notification_tmplt
2023/09/15 14:57:14.157693 ttdb.go:385: Persisted Template notification_tmplt
2023/09/15 14:57:14.157724 ttdb.go:366: Persisted Template notification_tmplt.txt
2023/09/15 14:57:14.219437 ttdb.go:379: Persisting Template wfstate2t_tmplt
2023/09/15 14:57:14.335365 ttdb.go:385: Persisted Template wfstate2t_tmplt
2023/09/15 14:57:14.335535 ttdb.go:366: Persisted Template wfstate2t_tmplt.html
2023/09/15 14:57:14.400822 ttdb.go:379: Persisting Template publishfile2t_tmplt
2023/09/15 14:57:14.464771 ttdb.go:385: Persisted Template publishfile2t_tmplt
2023/09/15 14:57:14.464807 ttdb.go:366: Persisted Template publishfile2t_tmplt.html
2023/09/15 14:57:14.527929 ttdb.go:379: Persisting Template react_tmplt
2023/09/15 14:57:14.590322 ttdb.go:385: Persisted Template react_tmplt
2023/09/15 14:57:14.590383 ttdb.go:366: Persisted Template react_tmplt.html
2023/09/15 14:57:14.654149 ttdb.go:379: Persisting Template pdsretrieve_tmplt
2023/09/15 14:57:14.720084 ttdb.go:385: Persisted Template pdsretrieve_tmplt
2023/09/15 14:57:14.720181 ttdb.go:366: Persisted Template pdsretrieve_tmplt.html
2023/09/15 14:57:14.784205 ttdb.go:379: Persisting Template allpatientSrvs_tmplt
2023/09/15 14:57:14.847851 ttdb.go:385: Persisted Template allpatientSrvs_tmplt
2023/09/15 14:57:14.847938 ttdb.go:366: Persisted Template allpatientSrvs_tmplt.html
2023/09/15 14:57:14.911409 ttdb.go:379: Persisting Template spa2t_tmplt
2023/09/15 14:57:14.991164 ttdb.go:385: Persisted Template spa2t_tmplt
2023/09/15 14:57:14.991258 ttdb.go:366: Persisted Template spa2t_tmplt.html
2023/09/15 14:57:15.055530 ttdb.go:379: Persisting Template xdw2t_tmplt
2023/09/15 14:57:15.136809 ttdb.go:385: Persisted Template xdw2t_tmplt
2023/09/15 14:57:15.136992 ttdb.go:366: Persisted Template xdw2t_tmplt.html
2023/09/15 14:57:15.200940 ttdb.go:379: Persisting Template spaheader2t_tmplt
2023/09/15 14:57:15.271539 ttdb.go:385: Persisted Template spaheader2t_tmplt
2023/09/15 14:57:15.271721 ttdb.go:366: Persisted Template spaheader2t_tmplt.html
2023/09/15 14:57:15.336169 ttdb.go:379: Persisting Template pds_tmplt
2023/09/15 14:57:15.403167 ttdb.go:385: Persisted Template pds_tmplt
2023/09/15 14:57:15.403348 ttdb.go:366: Persisted Template pds_tmplt.html
2023/09/15 14:57:15.467940 ttdb.go:379: Persisting Template error_tmplt
2023/09/15 14:57:15.590741 ttdb.go:385: Persisted Template error_tmplt
2023/09/15 14:57:15.590775 ttdb.go:366: Persisted Template error_tmplt.html
2023/09/15 14:57:15.771058 ttdb.go:379: Persisting Template dsuback_tmplt
2023/09/15 14:57:15.891825 ttdb.go:385: Persisted Template dsuback_tmplt
2023/09/15 14:57:15.891932 ttdb.go:366: Persisted Template dsuback_tmplt.xml
2023/09/15 14:57:16.020568 ttdb.go:379: Persisting Template pixm_tmplt
2023/09/15 14:57:16.198288 ttdb.go:385: Persisted Template pixm_tmplt
2023/09/15 14:57:16.198410 ttdb.go:366: Persisted Template pixm_tmplt.html
2023/09/15 14:57:16.346517 ttdb.go:379: Persisting Template subscriptions2t_tmplt
2023/09/15 14:57:16.526321 ttdb.go:385: Persisted Template subscriptions2t_tmplt
2023/09/15 14:57:16.526442 ttdb.go:366: Persisted Template subscriptions2t_tmplt.html
2023/09/15 14:57:16.604604 ttdb.go:379: Persisting Template codemaps2t_tmplt
2023/09/15 14:57:16.672825 ttdb.go:385: Persisted Template codemaps2t_tmplt
2023/09/15 14:57:16.672981 ttdb.go:366: Persisted Template codemaps2t_tmplt.html
2023/09/15 14:57:16.736852 ttdb.go:379: Persisting Template mhdpublish_tmplt
2023/09/15 14:57:16.806446 ttdb.go:385: Persisted Template mhdpublish_tmplt
2023/09/15 14:57:16.806580 ttdb.go:366: Persisted Template mhdpublish_tmplt.json
2023/09/15 14:57:16.869695 ttdb.go:379: Persisting Template events_tmplt
2023/09/15 14:57:16.937973 ttdb.go:385: Persisted Template events_tmplt
2023/09/15 14:57:16.938102 ttdb.go:366: Persisted Template events_tmplt.html
2023/09/15 14:57:17.000176 ttdb.go:379: Persisting Template uploadfile2t_tmplt
2023/09/15 14:57:17.064341 ttdb.go:385: Persisted Template uploadfile2t_tmplt
2023/09/15 14:57:17.064521 ttdb.go:366: Persisted Template uploadfile2t_tmplt.html
2023/09/15 14:57:17.064747 ttserver.go:40: Starting ICB Workflow Service. Service Endpoint http://MacBook-Pro-3.lan:8080/
2023/09/15 14:57:21.621035 ttgethandler.go:10: Processing new GET Request
2023/09/15 14:57:21.621182 ttproxy.go:138: 	Request Query Params
2023/09/15 14:57:21.621514 ttutil.go:140: 	{
  "User": "ian.thomas",
  "Org": "2tsolutions",
  "Role": "clinical",
  "Nhs": "6072406157"
}
2023/09/15 14:57:21.621569 ttgethandler.go:15: Path = /beta/spa/consumer/patient
2023/09/15 14:57:21.621630 tttmplts.go:37: CGL Worker starting
2023/09/15 14:57:21.621645 tttmplts.go:30: PIXm Worker starting
2023/09/15 14:57:21.622449 tthttp.go:15: Creating PIXm PDQ - Server URL http://lac-demo-01.tianispirit.co.uk:8081/SpiritPIXFhir/r4/Patient?identifier=2.16.840.1.113883.2.1.4.1%7C6072406157
2023/09/15 14:57:21.625569 tthttp.go:160: Request Headers 
map[Content-Type:[application/json]]
2023/09/15 14:57:21.625684 tthttp.go:160: Request Headers 
map[Accept:[application/json] X-Api-Key:[FNhb#OhxWiEiMdf+@6085k5Zmt] X-Api-Secret:[9710ea0fb4ffb5d56c2e62c71c30bdfhjsyr56a79d]]
2023/09/15 14:57:22.605651 tthttp.go:174: Server Response - Status Code 200 
{"data":{"client":{"basicDetails":{"address":{"addressLine1":"116 High St","addressLine2":"Guildford","addressLine3":"Surrey","addressLine4":"","addressLine5":"","postCode":"GU1 3HQ"},"birthDate":"19910819","disability":"No disability","lastEngagementByCGLDate":"20221130","lastFaceToFaceEngagementDate":"20221130","localIdentifier":177327,"name":{"family":"Marshall","given":"Imogen"},"nextCGLAppointmentDate":"20240108","nhsNumber":"6072406157","sexAtBirth":"Female"},"bbvInformation":{"bbvTested":"Yes","hepCLastTestDate":"20221122","hepCResult":"Unknown","hivPositive":"Yes"},"prescribingInformation":[],"riskInformation":{"lastSelfReportedDate":"20221130","mentalHealthDomain":{"attemptedSuicide":"Current","diagnosedMentalHealthCondition":"Within last 3 months","hospitalAdmissionsForMentalHealth":"Within last 3 months","notTakingPrescribedMedicationAsInstructed":"Within last 3 months","psychiatricOrPreviousCrisisTeamIntervention":"Current","selfHarm":"Within last 3 months","thoughtsOfSelfHarm":"Previous","thoughtsOfSuicide":"Previous"},"riskOfHarmToSelfDomain":{"assessedAsNotHavingMentalCapacity":"Current","learningDisability":"Previous"},"socialDomain":{"homelessRoughSleepingNFA":"Current","housingAtRisk":"Previous","sociallyIsolatedNoSupport":"Within last 3 months"},"substanceMisuseDomain":{"blackoutsOrSeizures":"Current","injecting":"Within last 3 months","polyDrugUse":"Within last 3 months","previousOverDose":"Within last 3 months"}},"safeguardingInformation":{"lastReviewDate":"20221130","riskHarmFromOthers":"Yes","riskToAdults":"Yes","riskToChildrenOrYP":"Yes","riskToSelf":"Yes"}},"keyWorker":{"localIdentifier":3048,"name":{"family":"Hudson","given":"Jamie"},"telecom":"123"}}}
2023/09/15 14:57:22.609042 ttutil.go:140: 	{
  "data": {
    "client": {
      "basicDetails": {
        "address": {
          "addressLine1": "116 High St",
          "addressLine2": "Guildford",
          "addressLine3": "Surrey",
          "postCode": "GU1 3HQ"
        },
        "birthDate": "19910819",
        "disability": "No disability",
        "lastEngagementByCGLDate": "20221130",
        "lastFaceToFaceEngagementDate": "20221130",
        "localIdentifier": 177327,
        "name": {
          "family": "Marshall",
          "given": "Imogen"
        },
        "nextCGLAppointmentDate": "20240108",
        "nhsNumber": "6072406157",
        "sexAtBirth": "Female"
      },
      "bbvInformation": {
        "bbvTested": "Yes",
        "hepCLastTestDate": "20221122",
        "hepCResult": "Unknown",
        "hivPositive": "Yes"
      },
      "drugTestResults": {
        "results": {}
      },
      "riskInformation": {
        "lastSelfReportedDate": "20221130",
        "mentalHealthDomain": {
          "attemptedSuicide": "Current",
          "diagnosedMentalHealthCondition": "Within last 3 months",
          "hospitalAdmissionsForMentalHealth": "Within last 3 months",
          "notTakingPrescribedMedicationAsInstructed": "Within last 3 months",
          "psychiatricOrPreviousCrisisTeamIntervention": "Current"
        },
        "riskOfHarmToSelfDomain": {
          "assessedAsNotHavingMentalCapacity": "Current",
          "learningDisability": "Previous"
        },
        "socialDomain": {
          "homelessRoughSleepingNFA": "Current",
          "housingAtRisk": "Previous",
          "sociallyIsolatedNoSupport": "Within last 3 months"
        },
        "substanceMisuseDomain": {
          "injecting": "Within last 3 months",
          "polyDrugUse": "Within last 3 months",
          "previousOverDose": "Within last 3 months"
        }
      },
      "safeguardingInformation": {
        "lastReviewDate": "20221130",
        "riskHarmFromOthers": "Yes",
        "riskToAdults": "Yes",
        "riskToChildrenOrYP": "Yes",
        "riskToSelf": "Yes"
      }
    },
    "keyWorker": {
      "localIdentifier": 3048,
      "name": {
        "family": "Hudson",
        "given": "Jamie"
      },
      "telecom": "123"
    }
  }
}
2023/09/15 14:57:22.609186 tttmplts.go:39: CGL Worker done
2023/09/15 14:57:22.609222 tttmplts.go:40: CGL Worker Status Code 200
2023/09/15 14:57:26.624013 tthttp.go:174: Server Response - Status Code 0 
2023/09/15 14:57:26.624212 tttmplts.go:32: PIXm Worker done
2023/09/15 14:57:26.624247 tttmplts.go:33: PIXm Worker Status Code 408
2023/09/15 14:57:26.624410 tthttp.go:56: Creating PDS Search Request - Server URL https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/Patient?family=Marshall&gender=female&birthdate=1991-08-19
2023/09/15 14:57:26.624521 tthttp.go:160: Request Headers 
map[Accept:[*/*] Content-Type:[application/json] X-Request-Id:[25a4e5b0-c5ea-4e25-a9c7-01cd79c11a9c]]
2023/09/15 14:57:26.871686 tthttp.go:174: Server Response - Status Code 200 
{"resourceType":"Bundle","type":"searchset","timestamp":"2023-09-15T13:57:26+00:00","total":0}
2023/09/15 14:57:27.062323 tttmplts.go:100: Caching 24 Templates
2023/09/15 14:57:27.072258 tttmplts.go:104: Template pds_tmplt caused Error template: pds_tmplt:53: unexpected EOF
2023/09/15 14:57:27.072919 server.go:3217: http: panic serving [::1]:53681: runtime error: invalid memory address or nil pointer dereference
goroutine 19 [running]:
net/http.(*conn).serve.func1()
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1854 +0xbf
panic({0x1434ca0, 0x17e4e70})
	/Users/IanThomas/sdk/go1.20.5/src/runtime/panic.go:890 +0x263
html/template.(*Template).New(0x14c1682?, {0xc00009b9e0?, 0xc0001c9fc0?})
	/Users/IanThomas/sdk/go1.20.5/src/html/template/template.go:305 +0x37
main.(*Trans).cacheTemplates(0xc0002e0000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:103 +0x1d2
main.(*Trans).setResponseFromTemplate(0xc0002e0000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:85 +0x45
main.(*Trans).setPatientTemplate(0xc0002e0000)
	/Users/IanThomas/go/src/ttxdwuser/main/tttmplts.go:53 +0x1b1
main.(*Trans).newGetHandler(0xc0002e0000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttgethandler.go:28 +0xd94
main.(*Trans).newProxyTrans(0xc0002e0000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:73 +0x4d1
main.Handle_HTTP_Request({0x15657d0, 0xc00022d180}, 0xc0002ca000)
	/Users/IanThomas/go/src/ttxdwuser/main/ttproxy.go:15 +0xeb
net/http.HandlerFunc.ServeHTTP(0xc0002cc01f?, {0x15657d0?, 0xc00022d180?}, 0x1064cee?)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2122 +0x2f
net/http.serverHandler.ServeHTTP({0xc000212900?}, {0x15657d0, 0xc00022d180}, 0xc0002ca000)
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:2936 +0x316
net/http.(*conn).serve(0xc0001a0fc0, {0x15659c8, 0xc0001a3260})
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:1995 +0x612
created by net/http.(*Server).Serve
	/Users/IanThomas/sdk/go1.20.5/src/net/http/server.go:3089 +0x5ed
2023/09/15 15:00:32.329219 ttserver.go:52: ICB Workflow Service stopped
